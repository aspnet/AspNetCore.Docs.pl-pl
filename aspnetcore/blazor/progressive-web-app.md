---
title: Twórz progresywne aplikacje sieci Web za pomocą ASP.NET Core Blazor WebAssembly
author: guardrex
description: Dowiedz się, jak utworzyć Blazor progresywną aplikację sieci Web (PWA), która korzysta z nowoczesnych funkcji przeglądarki, aby zachować takie działanie jak aplikacja klasyczna.
monikerRange: '>= aspnetcore-3.1'
ms.author: riande
ms.custom: mvc
ms.date: 01/11/2021
no-loc:
- appsettings.json
- ASP.NET Core Identity
- cookie
- Cookie
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: blazor/progressive-web-app
ms.openlocfilehash: fcf06295deb41f304b92caa82535a1197c909898
ms.sourcegitcommit: 75db2f684a9302b0be7925eab586aa091c6bd19f
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 02/01/2021
ms.locfileid: "99238234"
---
# <a name="build-progressive-web-applications-with-aspnet-core-no-locblazor-webassembly"></a><span data-ttu-id="7e378-103">Twórz progresywne aplikacje sieci Web za pomocą ASP.NET Core Blazor WebAssembly</span><span class="sxs-lookup"><span data-stu-id="7e378-103">Build Progressive Web Applications with ASP.NET Core Blazor WebAssembly</span></span>

<span data-ttu-id="7e378-104">[Steve Sanderson](https://github.com/SteveSandersonMS)</span><span class="sxs-lookup"><span data-stu-id="7e378-104">By [Steve Sanderson](https://github.com/SteveSandersonMS)</span></span>

<span data-ttu-id="7e378-105">Progresywna aplikacja sieci Web (PWA) jest zazwyczaj aplikacją jednostronicową, która używa nowoczesnych interfejsów API i funkcji w celu zachowania aplikacji klasycznych.</span><span class="sxs-lookup"><span data-stu-id="7e378-105">A Progressive Web Application (PWA) is usually a Single Page Application (SPA) that uses modern browser APIs and capabilities to behave like a desktop app.</span></span> <span data-ttu-id="7e378-106">Blazor WebAssembly to oparta na standardach platforma aplikacji sieci Web po stronie klienta, która może korzystać z dowolnego interfejsu API przeglądarki, w tym interfejsów API programu PWA, wymaganych w przypadku następujących możliwości:</span><span class="sxs-lookup"><span data-stu-id="7e378-106">Blazor WebAssembly is a standards-based client-side web app platform, so it can use any browser API, including PWA APIs required for the following capabilities:</span></span>

* <span data-ttu-id="7e378-107">Praca w trybie offline i ładowanie błyskawiczne niezależnie od szybkości sieci.</span><span class="sxs-lookup"><span data-stu-id="7e378-107">Working offline and loading instantly, independent of network speed.</span></span>
* <span data-ttu-id="7e378-108">Działa w osobnym oknie aplikacji, a nie tylko w oknie przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="7e378-108">Running in its own app window, not just a browser window.</span></span>
* <span data-ttu-id="7e378-109">Jest uruchamiany z menu Start systemu operacyjnego hosta, zadokowanego lub ekranu głównego.</span><span class="sxs-lookup"><span data-stu-id="7e378-109">Being launched from the host's operating system start menu, dock, or home screen.</span></span>
* <span data-ttu-id="7e378-110">Otrzymywanie powiadomień wypychanych z serwera wewnętrznej bazy danych, nawet jeśli użytkownik nie korzysta z aplikacji.</span><span class="sxs-lookup"><span data-stu-id="7e378-110">Receiving push notifications from a backend server, even while the user isn't using the app.</span></span>
* <span data-ttu-id="7e378-111">Automatyczna aktualizacja w tle.</span><span class="sxs-lookup"><span data-stu-id="7e378-111">Automatically updating in the background.</span></span>

<span data-ttu-id="7e378-112">Słowo *progresywne* służy do opisywania takich aplikacji, ponieważ:</span><span class="sxs-lookup"><span data-stu-id="7e378-112">The word *progressive* is used to describe such apps because:</span></span>

* <span data-ttu-id="7e378-113">Użytkownik może najpierw odnaleźć i korzystać z aplikacji w swojej przeglądarce internetowej, podobnie jak inne SPA.</span><span class="sxs-lookup"><span data-stu-id="7e378-113">A user might first discover and use the app within their web browser like any other SPA.</span></span>
* <span data-ttu-id="7e378-114">Później użytkownik postępuje nad instalowaniem go w systemie operacyjnym i włączaniem powiadomień wypychanych.</span><span class="sxs-lookup"><span data-stu-id="7e378-114">Later, the user progresses to installing it in their OS and enabling push notifications.</span></span>

## <a name="create-a-project-from-the-pwa-template"></a><span data-ttu-id="7e378-115">Tworzenie projektu na podstawie szablonu PWA</span><span class="sxs-lookup"><span data-stu-id="7e378-115">Create a project from the PWA template</span></span>

# <a name="visual-studio"></a>[<span data-ttu-id="7e378-116">Visual Studio</span><span class="sxs-lookup"><span data-stu-id="7e378-116">Visual Studio</span></span>](#tab/visual-studio)

<span data-ttu-id="7e378-117">Gdy tworzysz nową **Blazor WebAssembly aplikację** w oknie dialogowym **Tworzenie nowego projektu** , zaznacz pole wyboru **aplikacja sieci Web progresywna** :</span><span class="sxs-lookup"><span data-stu-id="7e378-117">When creating a new **Blazor WebAssembly App** in the **Create a New Project** dialog, select the **Progressive Web Application** check box:</span></span>

![W oknie dialogowym Nowy projekt programu Visual Studio jest zaznaczone pole wyboru "progresywna aplikacja sieci Web".](progressive-web-app/_static/image1.png)

<!--

# [Visual Studio for Mac](#tab/visual-studio-mac)

-->

# <a name="visual-studio-code--net-core-cli"></a>[<span data-ttu-id="7e378-119">Visual Studio Code/interfejs wiersza polecenia platformy .NET Core</span><span class="sxs-lookup"><span data-stu-id="7e378-119">Visual Studio Code / .NET Core CLI</span></span>](#tab/visual-studio-code+netcore-cli)

<span data-ttu-id="7e378-120">Użyj następującego polecenia, aby utworzyć projekt PWA w powłoce poleceń z `--pwa` przełącznikiem:</span><span class="sxs-lookup"><span data-stu-id="7e378-120">Use the following command to create a PWA project in a command shell with the `--pwa` switch:</span></span>

```dotnetcli
dotnet new blazorwasm -o MyBlazorPwa --pwa
```

<span data-ttu-id="7e378-121">W poprzednim poleceniu `-o|--output` opcja powoduje utworzenie nowego folderu dla aplikacji o nazwie `MyBlazorPwa` .</span><span class="sxs-lookup"><span data-stu-id="7e378-121">In the preceding command, the `-o|--output` option creates a new folder for the app named `MyBlazorPwa`.</span></span>

---

<span data-ttu-id="7e378-122">Opcjonalnie można skonfigurować PWA dla aplikacji utworzonej przy użyciu szablonu hostowanego ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="7e378-122">Optionally, PWA can be configured for an app created from the ASP.NET Core Hosted template.</span></span> <span data-ttu-id="7e378-123">Scenariusz PWA jest niezależny od modelu hostingu.</span><span class="sxs-lookup"><span data-stu-id="7e378-123">The PWA scenario is independent of the hosting model.</span></span>

## <a name="convert-an-existing-no-locblazor-webassembly-app-into-a-pwa"></a><span data-ttu-id="7e378-124">Konwertowanie istniejącej Blazor WebAssembly aplikacji do PWA</span><span class="sxs-lookup"><span data-stu-id="7e378-124">Convert an existing Blazor WebAssembly app into a PWA</span></span>

<span data-ttu-id="7e378-125">Przekonwertuj istniejącą Blazor WebAssembly aplikację do PWA zgodnie ze wskazówkami w tej sekcji.</span><span class="sxs-lookup"><span data-stu-id="7e378-125">Convert an existing Blazor WebAssembly app into a PWA following the guidance in this section.</span></span>

<span data-ttu-id="7e378-126">W pliku projektu aplikacji:</span><span class="sxs-lookup"><span data-stu-id="7e378-126">In the app's project file:</span></span>

* <span data-ttu-id="7e378-127">Dodaj następującą `ServiceWorkerAssetsManifest` Właściwość do `PropertyGroup` :</span><span class="sxs-lookup"><span data-stu-id="7e378-127">Add the following `ServiceWorkerAssetsManifest` property to a `PropertyGroup`:</span></span>

  ```xml
    ...
    <ServiceWorkerAssetsManifest>service-worker-assets.js</ServiceWorkerAssetsManifest>
  </PropertyGroup>
   ```

* <span data-ttu-id="7e378-128">Dodaj następujący `ServiceWorker` element do `ItemGroup` :</span><span class="sxs-lookup"><span data-stu-id="7e378-128">Add the following `ServiceWorker` item to an `ItemGroup`:</span></span>

  ```xml
  <ItemGroup>
    <ServiceWorker Include="wwwroot\service-worker.js" 
      PublishedContent="wwwroot\service-worker.published.js" />
  </ItemGroup>
  ```

<span data-ttu-id="7e378-129">Aby uzyskać statyczne zasoby, należy użyć **jednej** z następujących metod:</span><span class="sxs-lookup"><span data-stu-id="7e378-129">To obtain static assets, use **one** of the following approaches:</span></span>

::: moniker range=">= aspnetcore-5.0"

* <span data-ttu-id="7e378-130">Utwórz oddzielny, nowy projekt PWA przy użyciu [`dotnet new`](/dotnet/core/tools/dotnet-new) polecenia w powłoce poleceń:</span><span class="sxs-lookup"><span data-stu-id="7e378-130">Create a separate, new PWA project with the [`dotnet new`](/dotnet/core/tools/dotnet-new) command in a command shell:</span></span>

  ```dotnetcli
  dotnet new blazorwasm -o MyBlazorPwa --pwa
  ```
  
  <span data-ttu-id="7e378-131">W poprzednim poleceniu `-o|--output` opcja powoduje utworzenie nowego folderu dla aplikacji o nazwie `MyBlazorPwa` .</span><span class="sxs-lookup"><span data-stu-id="7e378-131">In the preceding command, the `-o|--output` option creates a new folder for the app named `MyBlazorPwa`.</span></span>
  
  <span data-ttu-id="7e378-132">Jeśli nie chcesz konwertować aplikacji dla najnowszej wersji, przekaż tę `-f|--framework` opcję.</span><span class="sxs-lookup"><span data-stu-id="7e378-132">If you aren't converting an app for the latest release, pass the `-f|--framework` option.</span></span> <span data-ttu-id="7e378-133">W poniższym przykładzie jest tworzona aplikacja dla ASP.NET Core w wersji 3,1:</span><span class="sxs-lookup"><span data-stu-id="7e378-133">The following example creates the app for ASP.NET Core version 3.1:</span></span>
  
  ```dotnetcli
  dotnet new blazorwasm -o MyBlazorPwa --pwa -f netcoreapp3.1
  ```

* <span data-ttu-id="7e378-134">Przejdź do repozytorium ASP.NET Core GitHub pod następującym adresem URL, który łączy się ze źródłem i zasobami odwołania do 5,0.</span><span class="sxs-lookup"><span data-stu-id="7e378-134">Navigate to the ASP.NET Core GitHub repository at the following URL, which links to 5.0 release reference source and assets.</span></span> <span data-ttu-id="7e378-135">Jeśli nie przekonwertujesz aplikacji na wersję 5,0, wybierz wersję, z którą pracujesz, z listy rozwijanej **Przełącz gałęzie lub Tagi** , która ma zastosowanie do Twojej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="7e378-135">If you aren't converting an app for the 5.0 release, select the release that you're working with from the **Switch branches or tags** drop-down list that applies to your app.</span></span>

  [<span data-ttu-id="7e378-136">Blazor WebAssemblyfolder szablonu projektu dotnet/aspnetcore (wersja 5,0 `wwwroot` )</span><span class="sxs-lookup"><span data-stu-id="7e378-136">dotnet/aspnetcore (release 5.0) Blazor WebAssembly project template `wwwroot` folder</span></span>](https://github.com/dotnet/aspnetcore/tree/release/5.0/src/ProjectTemplates/Web.ProjectTemplates/content/ComponentsWebAssembly-CSharp/Client/wwwroot)

::: moniker-end

::: moniker range="< aspnetcore-5.0"

* <span data-ttu-id="7e378-137">Utwórz oddzielny, nowy projekt PWA za pomocą [`dotnet new`](/dotnet/core/tools/dotnet-new) polecenia w powłoce poleceń.</span><span class="sxs-lookup"><span data-stu-id="7e378-137">Create a separate, new PWA project with the [`dotnet new`](/dotnet/core/tools/dotnet-new) command in a command shell.</span></span> <span data-ttu-id="7e378-138">Przekaż `-f|--framework` opcję, aby wybrać wersję.</span><span class="sxs-lookup"><span data-stu-id="7e378-138">Pass the `-f|--framework` option to select the version.</span></span> <span data-ttu-id="7e378-139">W poniższym przykładzie jest tworzona aplikacja dla ASP.NET Core w wersji 3,1:</span><span class="sxs-lookup"><span data-stu-id="7e378-139">The following example creates the app for ASP.NET Core version 3.1:</span></span>
  
  ```dotnetcli
  dotnet new blazorwasm -o MyBlazorPwa --pwa -f netcoreapp3.1
  ```
  
  <span data-ttu-id="7e378-140">W poprzednim poleceniu `-o|--output` opcja powoduje utworzenie nowego folderu dla aplikacji o nazwie `MyBlazorPwa` .</span><span class="sxs-lookup"><span data-stu-id="7e378-140">In the preceding command, the `-o|--output` option creates a new folder for the app named `MyBlazorPwa`.</span></span>

* <span data-ttu-id="7e378-141">Przejdź do repozytorium ASP.NET Core GitHub pod następującym adresem URL, który zawiera linki do źródła i zasobów odwołania do 3,1:</span><span class="sxs-lookup"><span data-stu-id="7e378-141">Navigate to the ASP.NET Core GitHub repository at the following URL, which links to 3.1 release reference source and assets:</span></span>

  [<span data-ttu-id="7e378-142">Blazor WebAssemblyfolder szablonu projektu dotnet/aspnetcore (wersja 3,1 `wwwroot` )</span><span class="sxs-lookup"><span data-stu-id="7e378-142">dotnet/aspnetcore (release 3.1) Blazor WebAssembly project template `wwwroot` folder</span></span>](https://github.com/dotnet/aspnetcore/tree/release/3.1/src/ProjectTemplates/ComponentsWebAssembly.ProjectTemplates/content/ComponentsWebAssembly-CSharp/Client/wwwroot)

  > [!NOTE]
  > <span data-ttu-id="7e378-143">Adres URL Blazor WebAssembly szablonu projektu został zmieniony po wydaniu ASP.NET Core 3,1.</span><span class="sxs-lookup"><span data-stu-id="7e378-143">The URL for Blazor WebAssembly project template changed after the release of ASP.NET Core 3.1.</span></span> <span data-ttu-id="7e378-144">Zasoby referencyjne dla 5,0 lub nowszych są dostępne pod następującym adresem URL:</span><span class="sxs-lookup"><span data-stu-id="7e378-144">Reference assets for 5.0 or later are available at the following URL:</span></span>
  >
  > [<span data-ttu-id="7e378-145">Blazor WebAssemblyfolder szablonu projektu dotnet/aspnetcore (wersja 5,0 `wwwroot` )</span><span class="sxs-lookup"><span data-stu-id="7e378-145">dotnet/aspnetcore (release 5.0) Blazor WebAssembly project template `wwwroot` folder</span></span>](https://github.com/dotnet/aspnetcore/tree/release/5.0/src/ProjectTemplates/Web.ProjectTemplates/content/ComponentsWebAssembly-CSharp/Client/wwwroot)

::: moniker-end

<span data-ttu-id="7e378-146">Z folderu źródłowego `wwwroot` w aplikacji utworzonej lub z zasobów referencyjnych w `dotnet/aspnetcore` repozytorium GitHub Skopiuj następujące pliki do `wwwroot` folderu aplikacji:</span><span class="sxs-lookup"><span data-stu-id="7e378-146">From the source `wwwroot` folder either in the app that you created or from the reference assets in the `dotnet/aspnetcore` GitHub repository, copy the following files into the app's `wwwroot` folder:</span></span>

* `icon-512.png`
* `manifest.json`
* `service-worker.js`
* `service-worker.published.js`

<span data-ttu-id="7e378-147">W `wwwroot/index.html` pliku aplikacji:</span><span class="sxs-lookup"><span data-stu-id="7e378-147">In the app's `wwwroot/index.html` file:</span></span>

* <span data-ttu-id="7e378-148">Dodaj `<link>` elementy dla ikony manifestu i aplikacji:</span><span class="sxs-lookup"><span data-stu-id="7e378-148">Add `<link>` elements for the manifest and app icon:</span></span>

  ```html
  <link href="manifest.json" rel="manifest" />
  <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png" />
  ```

* <span data-ttu-id="7e378-149">Dodaj następujący `<script>` tag w tagu zamykającym `</body>` bezpośrednio po `blazor.webassembly.js` tagu skryptu:</span><span class="sxs-lookup"><span data-stu-id="7e378-149">Add the following `<script>` tag inside the closing `</body>` tag immediately after the `blazor.webassembly.js` script tag:</span></span>

  ```html
      ...
      <script>navigator.serviceWorker.register('service-worker.js');</script>
  </body>
  ```

## <a name="installation-and-app-manifest"></a><span data-ttu-id="7e378-150">Manifest instalacji i aplikacji</span><span class="sxs-lookup"><span data-stu-id="7e378-150">Installation and app manifest</span></span>

<span data-ttu-id="7e378-151">Podczas odwiedzania aplikacji utworzonej przy użyciu szablonu PWA użytkownicy mają możliwość instalowania aplikacji w menu Start, zadokowanym lub na ekranie głównym systemu operacyjnego.</span><span class="sxs-lookup"><span data-stu-id="7e378-151">When visiting an app created using the PWA template, users have the option of installing the app into their OS's start menu, dock, or home screen.</span></span> <span data-ttu-id="7e378-152">Sposób przedstawiania tej opcji zależy od przeglądarki użytkownika.</span><span class="sxs-lookup"><span data-stu-id="7e378-152">The way this option is presented depends on the user's browser.</span></span> <span data-ttu-id="7e378-153">W przypadku korzystania z przeglądarek programu Desktop w formacie chromu, takich jak Edge lub Chrome, na pasku adresu URL pojawia się przycisk **Dodaj** .</span><span class="sxs-lookup"><span data-stu-id="7e378-153">When using desktop Chromium-based browsers, such as Edge or Chrome, an **Add** button appears within the URL bar.</span></span> <span data-ttu-id="7e378-154">Gdy użytkownik wybierze przycisk **Dodaj** , pojawi się okno dialogowe potwierdzenia:</span><span class="sxs-lookup"><span data-stu-id="7e378-154">After the user selects the **Add** button, they receive a confirmation dialog:</span></span>

![Okno dialogowe potwierdzenia w usłudze Google Chrome prezentuje przycisk Zainstaluj użytkownikowi dla aplikacji "my::: No-Loc (Blazor):::P wa".](progressive-web-app/_static/image2.png)

<span data-ttu-id="7e378-156">W systemie iOS osoby odwiedzające mogą zainstalować program PWA przy użyciu przycisku **udostępniania** Safari i jego opcji **Dodaj do homescreen** .</span><span class="sxs-lookup"><span data-stu-id="7e378-156">On iOS, visitors can install the PWA using Safari's **Share** button and its **Add to Homescreen** option.</span></span> <span data-ttu-id="7e378-157">W programie Chrome dla systemu Android użytkownicy powinni wybrać przycisk **menu** w prawym górnym rogu, a następnie **dodać do ekranu głównego**.</span><span class="sxs-lookup"><span data-stu-id="7e378-157">On Chrome for Android, users should select the **Menu** button in the upper-right corner, followed by **Add to Home screen**.</span></span>

<span data-ttu-id="7e378-158">Po zainstalowaniu aplikacja zostanie wyświetlona w osobnym oknie bez paska adresu:</span><span class="sxs-lookup"><span data-stu-id="7e378-158">Once installed, the app appears in its own window without an address bar:</span></span>

![Aplikacja "my::: No-Loc (Blazor):::P wa jest uruchamiana w przeglądarce Google Chrome bez paska adresu.](progressive-web-app/_static/image3.png)

<span data-ttu-id="7e378-160">Aby dostosować tytuł okna, schemat kolorów, ikonę lub inne szczegóły, zobacz `manifest.json` plik w `wwwroot` katalogu projektu.</span><span class="sxs-lookup"><span data-stu-id="7e378-160">To customize the window's title, color scheme, icon, or other details, see the `manifest.json` file in the project's `wwwroot` directory.</span></span> <span data-ttu-id="7e378-161">Schemat tego pliku jest definiowany przez standardy sieci Web.</span><span class="sxs-lookup"><span data-stu-id="7e378-161">The schema of this file is defined by web standards.</span></span> <span data-ttu-id="7e378-162">Aby uzyskać więcej informacji, zobacz [powiadomienia MDN Web docs: manifest aplikacji sieci Web](https://developer.mozilla.org/docs/Web/Manifest).</span><span class="sxs-lookup"><span data-stu-id="7e378-162">For more information, see [MDN web docs: Web App Manifest](https://developer.mozilla.org/docs/Web/Manifest).</span></span>

## <a name="offline-support"></a><span data-ttu-id="7e378-163">Obsługa offline</span><span class="sxs-lookup"><span data-stu-id="7e378-163">Offline support</span></span>

<span data-ttu-id="7e378-164">Domyślnie aplikacje utworzone przy użyciu opcji szablonu PWA obsługują uruchamianie w trybie offline.</span><span class="sxs-lookup"><span data-stu-id="7e378-164">By default, apps created using the PWA template option have support for running offline.</span></span> <span data-ttu-id="7e378-165">Użytkownik musi najpierw odwiedzić aplikację, gdy jest w trybie online.</span><span class="sxs-lookup"><span data-stu-id="7e378-165">A user must first visit the app while they're online.</span></span> <span data-ttu-id="7e378-166">Przeglądarka automatycznie pobiera i buforuje wszystkie zasoby wymagane do działania w trybie offline.</span><span class="sxs-lookup"><span data-stu-id="7e378-166">The browser automatically downloads and caches all of the resources required to operate offline.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="7e378-167">Wsparcie programistyczne może kolidować z typowym cyklem programistycznym wprowadzania zmian i testowania.</span><span class="sxs-lookup"><span data-stu-id="7e378-167">Development support would interfere with the usual development cycle of making changes and testing them.</span></span> <span data-ttu-id="7e378-168">W związku z tym obsługa w trybie offline jest włączona tylko dla *opublikowanych* aplikacji.</span><span class="sxs-lookup"><span data-stu-id="7e378-168">Therefore, offline support is only enabled for *published* apps.</span></span> 

> [!WARNING]
> <span data-ttu-id="7e378-169">Jeśli zamierzasz rozpowszechnić aplikację PWA z obsługą trybu offline, istnieje [kilka ważnych ostrzeżeń i](#caveats-for-offline-pwas)ich zamiar.</span><span class="sxs-lookup"><span data-stu-id="7e378-169">If you intend to distribute an offline-enabled PWA, there are [several important warnings and caveats](#caveats-for-offline-pwas).</span></span> <span data-ttu-id="7e378-170">Te scenariusze są związane z PWAs w trybie offline i nie są specyficzne dla programu Blazor .</span><span class="sxs-lookup"><span data-stu-id="7e378-170">These scenarios are inherent to offline PWAs and not specific to Blazor.</span></span> <span data-ttu-id="7e378-171">Pamiętaj, aby przeczytać i zrozumieć te zastrzeżenia przed wprowadzeniem założeń dotyczących sposobu działania aplikacji z obsługą trybu offline.</span><span class="sxs-lookup"><span data-stu-id="7e378-171">Be sure to read and understand these caveats before making assumptions about how your offline-enabled app will work.</span></span>

<span data-ttu-id="7e378-172">Aby zobaczyć, jak działa pomoc techniczna w trybie offline:</span><span class="sxs-lookup"><span data-stu-id="7e378-172">To see how offline support works:</span></span>

1. <span data-ttu-id="7e378-173">Opublikuj aplikację.</span><span class="sxs-lookup"><span data-stu-id="7e378-173">Publish the app.</span></span> <span data-ttu-id="7e378-174">Aby uzyskać więcej informacji, zobacz <xref:blazor/host-and-deploy/index#publish-the-app>.</span><span class="sxs-lookup"><span data-stu-id="7e378-174">For more information, see <xref:blazor/host-and-deploy/index#publish-the-app>.</span></span>
1. <span data-ttu-id="7e378-175">Wdróż aplikację na serwerze obsługującym protokół HTTPS i uzyskaj dostęp do aplikacji w przeglądarce przy użyciu bezpiecznego adresu HTTPS.</span><span class="sxs-lookup"><span data-stu-id="7e378-175">Deploy the app to a server that supports HTTPS, and access the app in a browser at its secure HTTPS address.</span></span>
1. <span data-ttu-id="7e378-176">Otwórz narzędzia deweloperskie przeglądarki i sprawdź, czy *proces roboczy usługi* jest zarejestrowany dla hosta na karcie **aplikacja** :</span><span class="sxs-lookup"><span data-stu-id="7e378-176">Open the browser's dev tools and verify that a *Service Worker* is registered for the host on the **Application** tab:</span></span>

   ![Karta "aplikacja" narzędzia deweloperskiego dla deweloperów Google Chrome pokazuje, że proces roboczy usługi został aktywowany i uruchomiony.](progressive-web-app/_static/image4.png)

1. <span data-ttu-id="7e378-178">Załaduj ponownie stronę i sprawdź kartę **Sieć** . **proces roboczy usługi** lub pamięć **podręczna pamięci** są wyświetlane jako źródła dla wszystkich zasobów strony:</span><span class="sxs-lookup"><span data-stu-id="7e378-178">Reload the page and examine the **Network** tab. **Service Worker** or **memory cache** are listed as the sources for all of the page's assets:</span></span>

   ![Karta Sieć w narzędziu deweloperskim firmy Google Chrome przedstawia źródła dla wszystkich elementów zawartości strony.](progressive-web-app/_static/image5.png)

1. <span data-ttu-id="7e378-180">Aby sprawdzić, czy przeglądarka nie jest zależna od dostępu do sieci w celu załadowania aplikacji, należy wykonać jedną z:</span><span class="sxs-lookup"><span data-stu-id="7e378-180">To verify that the browser isn't dependent on network access to load the app, either:</span></span>

   * <span data-ttu-id="7e378-181">Zamknij serwer sieci Web i zobacz, jak aplikacja nadal działa normalnie, co obejmuje ponowne ładowanie stron.</span><span class="sxs-lookup"><span data-stu-id="7e378-181">Shut down the web server and see how the app continues to function normally, which includes page reloads.</span></span> <span data-ttu-id="7e378-182">Podobnie aplikacja nadal działa normalnie, gdy istnieje wolne połączenie sieciowe.</span><span class="sxs-lookup"><span data-stu-id="7e378-182">Likewise, the app continues to function normally when there's a slow network connection.</span></span>
   * <span data-ttu-id="7e378-183">Poinstruuj przeglądarkę, aby zasymulować tryb offline na karcie **Sieć** :</span><span class="sxs-lookup"><span data-stu-id="7e378-183">Instruct the browser to simulate offline mode in the **Network** tab:</span></span>

   ![Karta "Sieć" programu Google Chrome Developer Tools z menu rozwijanego trybu przeglądarki zmienia się z "online" na "offline".](progressive-web-app/_static/image6.png)

<span data-ttu-id="7e378-185">Obsługa w trybie offline przy użyciu procesu roboczego usługi jest standardem internetowym, który nie jest specyficzny dla programu Blazor .</span><span class="sxs-lookup"><span data-stu-id="7e378-185">Offline support using a service worker is a web standard, not specific to Blazor.</span></span> <span data-ttu-id="7e378-186">Aby uzyskać więcej informacji na temat procesów roboczych usługi, zobacz [powiadomienia MDN Web docs: interfejs API procesu roboczego usługi](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span><span class="sxs-lookup"><span data-stu-id="7e378-186">For more information on service workers, see [MDN web docs: Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span></span> <span data-ttu-id="7e378-187">Aby dowiedzieć się więcej o typowych wzorcach użycia dla pracowników usług, zobacz [Google Web: cykl życia procesu roboczego usługi](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span><span class="sxs-lookup"><span data-stu-id="7e378-187">To learn more about common usage patterns for service workers, see [Google Web: The Service Worker Lifecycle](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span></span>

<span data-ttu-id="7e378-188">Blazorszablon aplikacji PWA tworzy dwa pliki procesów roboczych usługi:</span><span class="sxs-lookup"><span data-stu-id="7e378-188">Blazor's PWA template produces two service worker files:</span></span>

* <span data-ttu-id="7e378-189">`wwwroot/service-worker.js`, który jest używany podczas opracowywania.</span><span class="sxs-lookup"><span data-stu-id="7e378-189">`wwwroot/service-worker.js`, which is used during development.</span></span>
* <span data-ttu-id="7e378-190">`wwwroot/service-worker.published.js`, który jest używany po opublikowaniu aplikacji.</span><span class="sxs-lookup"><span data-stu-id="7e378-190">`wwwroot/service-worker.published.js`, which is used after the app is published.</span></span>

<span data-ttu-id="7e378-191">Aby współużytkować logikę między dwoma plikami roboczymi usługi, należy wziąć pod uwagę następujące podejście:</span><span class="sxs-lookup"><span data-stu-id="7e378-191">To share logic between the two service worker files, consider the following approach:</span></span>

* <span data-ttu-id="7e378-192">Dodaj trzeci plik JavaScript do przechowywania typowej logiki.</span><span class="sxs-lookup"><span data-stu-id="7e378-192">Add a third JavaScript file to hold the common logic.</span></span>
* <span data-ttu-id="7e378-193">Służy [`self.importScripts`](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) do ładowania wspólnej logiki do obu plików procesów roboczych usługi.</span><span class="sxs-lookup"><span data-stu-id="7e378-193">Use [`self.importScripts`](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) to load the common logic into both service worker files.</span></span>

### <a name="cache-first-fetch-strategy"></a><span data-ttu-id="7e378-194">Strategia pobierania w pamięci podręcznej</span><span class="sxs-lookup"><span data-stu-id="7e378-194">Cache-first fetch strategy</span></span>

<span data-ttu-id="7e378-195">Wbudowany `service-worker.published.js` proces roboczy usługi rozpoznaje żądania przy użyciu strategii *pierwszej pamięci podręcznej* .</span><span class="sxs-lookup"><span data-stu-id="7e378-195">The built-in `service-worker.published.js` service worker resolves requests using a *cache-first* strategy.</span></span> <span data-ttu-id="7e378-196">Oznacza to, że pracownik usługi woli zwrócić zawartość buforowaną, bez względu na to, czy użytkownik ma dostęp do sieci czy na serwerze jest dostępna nowsza zawartość.</span><span class="sxs-lookup"><span data-stu-id="7e378-196">This means that the service worker prefers to return cached content, regardless of whether the user has network access or newer content is available on the server.</span></span>

<span data-ttu-id="7e378-197">Strategia pierwszej pamięci podręcznej jest cenna, ponieważ:</span><span class="sxs-lookup"><span data-stu-id="7e378-197">The cache-first strategy is valuable because:</span></span>

* <span data-ttu-id="7e378-198">**Zapewnia niezawodność.**</span><span class="sxs-lookup"><span data-stu-id="7e378-198">**It ensures reliability.**</span></span> <span data-ttu-id="7e378-199">Dostęp do sieci nie jest stanem logicznym.</span><span class="sxs-lookup"><span data-stu-id="7e378-199">Network access isn't a boolean state.</span></span> <span data-ttu-id="7e378-200">Użytkownik nie jest po prostu w trybie online lub offline:</span><span class="sxs-lookup"><span data-stu-id="7e378-200">A user isn't simply online or offline:</span></span>

  * <span data-ttu-id="7e378-201">Urządzenie użytkownika może założyć, że jest w trybie online, ale sieć może być zbyt mała, aby można było oczekiwać.</span><span class="sxs-lookup"><span data-stu-id="7e378-201">The user's device may assume it's online, but the network might be so slow as to be impractical to wait for.</span></span>
  * <span data-ttu-id="7e378-202">Sieć może zwrócić nieprawidłowe wyniki dla niektórych adresów URL, na przykład gdy istnieje Portal sieci Wi-Fi, który aktualnie blokuje lub przekierowuje określone żądania.</span><span class="sxs-lookup"><span data-stu-id="7e378-202">The network might return invalid results for certain URLs, such as when there's a captive WIFI portal that's currently blocking or redirecting certain requests.</span></span>
  
  <span data-ttu-id="7e378-203">Jest to dlatego, że `navigator.onLine` interfejs API przeglądarki nie jest niezawodny i nie powinien być zależny od tego, czy nie.</span><span class="sxs-lookup"><span data-stu-id="7e378-203">This is why the browser's `navigator.onLine` API isn't reliable and shouldn't be depended upon.</span></span>

* <span data-ttu-id="7e378-204">**Zapewnia to poprawność.**</span><span class="sxs-lookup"><span data-stu-id="7e378-204">**It ensures correctness.**</span></span> <span data-ttu-id="7e378-205">Podczas kompilowania pamięci podręcznej zasobów w trybie offline, proces roboczy usługi używa tworzenia skrótów zawartości w celu zagwarantowania, że pobrano kompletną i spójną migawkę zasobów w jednym czasie.</span><span class="sxs-lookup"><span data-stu-id="7e378-205">When building a cache of offline resources, the service worker uses content hashing to guarantee it has fetched a complete and self-consistent snapshot of resources at a single instant in time.</span></span> <span data-ttu-id="7e378-206">Ta pamięć podręczna jest następnie używana jako jednostka niepodzielna.</span><span class="sxs-lookup"><span data-stu-id="7e378-206">This cache is then used as an atomic unit.</span></span> <span data-ttu-id="7e378-207">Nie ma żadnego punktu, aby uzyskać więcej zasobów w sieci, ponieważ jedyne wymagane wersje to te, które są już w pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="7e378-207">There's no point asking the network for newer resources, since the only versions required are the ones already cached.</span></span> <span data-ttu-id="7e378-208">Wszelkie inne zagrożenia niespójnością i niezgodnością (na przykład próba użycia wersji zestawów .NET, które nie zostały skompilowane razem).</span><span class="sxs-lookup"><span data-stu-id="7e378-208">Anything else risks inconsistency and incompatibility (for example, trying to use versions of .NET assemblies that weren't compiled together).</span></span>

### <a name="background-updates"></a><span data-ttu-id="7e378-209">Aktualizacje w tle</span><span class="sxs-lookup"><span data-stu-id="7e378-209">Background updates</span></span>

<span data-ttu-id="7e378-210">Jako model psychiczny Możesz pomyśleć o tym, że w trybie offline — w przypadku aplikacji mobilnej, która może być zainstalowana.</span><span class="sxs-lookup"><span data-stu-id="7e378-210">As a mental model, you can think of an offline-first PWA as behaving like a mobile app that can be installed.</span></span> <span data-ttu-id="7e378-211">Aplikacja zostanie uruchomiona natychmiast niezależnie od łączności sieciowej, ale zainstalowana logika aplikacji pochodzi z migawki do punktu w czasie, która może nie być najnowszą wersją.</span><span class="sxs-lookup"><span data-stu-id="7e378-211">The app starts up immediately regardless of network connectivity, but the installed app logic comes from a point-in-time snapshot that might not be the latest version.</span></span>

<span data-ttu-id="7e378-212">BlazorSzablon PWA tworzy aplikacje, które automatycznie próbują zaktualizować się w tle zawsze, gdy użytkownik odwiedza i ma działające połączenie sieciowe.</span><span class="sxs-lookup"><span data-stu-id="7e378-212">The Blazor PWA template produces apps that automatically try to update themselves in the background whenever the user visits and has a working network connection.</span></span> <span data-ttu-id="7e378-213">Oto jak to działa:</span><span class="sxs-lookup"><span data-stu-id="7e378-213">The way this works is as follows:</span></span>

* <span data-ttu-id="7e378-214">Podczas kompilacji projekt generuje *manifest zasobów roboczych usługi*.</span><span class="sxs-lookup"><span data-stu-id="7e378-214">During compilation, the project generates a *service worker assets manifest*.</span></span> <span data-ttu-id="7e378-215">Domyślnie jest to nazywane `service-worker-assets.js` .</span><span class="sxs-lookup"><span data-stu-id="7e378-215">By default, this is called `service-worker-assets.js`.</span></span> <span data-ttu-id="7e378-216">Manifest zawiera listę wszystkich zasobów statycznych wymaganych przez aplikację do działania w trybie offline, takich jak zestawy .NET, pliki JavaScript i CSS, w tym ich skróty zawartości.</span><span class="sxs-lookup"><span data-stu-id="7e378-216">The manifest lists all the static resources that the app requires to function offline, such as .NET assemblies, JavaScript files, and CSS, including their content hashes.</span></span> <span data-ttu-id="7e378-217">Lista zasobów jest załadowana przez proces roboczy usługi, aby uzyskać informację o tym, które zasoby mają być buforowane.</span><span class="sxs-lookup"><span data-stu-id="7e378-217">The resource list is loaded by the service worker so that it knows which resources to cache.</span></span>
* <span data-ttu-id="7e378-218">Za każdym razem, gdy użytkownik odwiedzi aplikację, ponowne żądania przeglądarki `service-worker.js` i `service-worker-assets.js` w tle.</span><span class="sxs-lookup"><span data-stu-id="7e378-218">Each time the user visits the app, the browser re-requests `service-worker.js` and `service-worker-assets.js` in the background.</span></span> <span data-ttu-id="7e378-219">Pliki są porównywane bajtowo z istniejącym zainstalowanym pracownikiem usługi.</span><span class="sxs-lookup"><span data-stu-id="7e378-219">The files are compared byte-for-byte with the existing installed service worker.</span></span> <span data-ttu-id="7e378-220">Jeśli serwer zwróci zmianę zawartości dla dowolnego z tych plików, proces roboczy usługi próbuje zainstalować nową wersję programu.</span><span class="sxs-lookup"><span data-stu-id="7e378-220">If the server returns changed content for either of these files, the service worker attempts to install a new version of itself.</span></span>
* <span data-ttu-id="7e378-221">Podczas instalowania nowej wersji, proces roboczy usługi tworzy nową, oddzielną pamięć podręczną dla zasobów w trybie offline i rozpoczyna zapełnianie pamięci podręcznej zasobami wymienionymi w temacie `service-worker-assets.js` .</span><span class="sxs-lookup"><span data-stu-id="7e378-221">When installing a new version of itself, the service worker creates a new, separate cache for offline resources and starts populating the cache with resources listed in `service-worker-assets.js`.</span></span> <span data-ttu-id="7e378-222">Ta logika jest implementowana w `onInstall` funkcji wewnątrz `service-worker.published.js` .</span><span class="sxs-lookup"><span data-stu-id="7e378-222">This logic is implemented in the `onInstall` function inside `service-worker.published.js`.</span></span>
* <span data-ttu-id="7e378-223">Proces zostanie zakończony pomyślnie, gdy wszystkie zasoby są ładowane bez błędu, a wszystkie skróty zawartości są zgodne.</span><span class="sxs-lookup"><span data-stu-id="7e378-223">The process completes successfully when all of the resources are loaded without error and all content hashes match.</span></span> <span data-ttu-id="7e378-224">Jeśli to się powiedzie, nowy proces roboczy usługi przechodzi w stan *oczekiwania na aktywację* .</span><span class="sxs-lookup"><span data-stu-id="7e378-224">If successful, the new service worker enters a *waiting for activation* state.</span></span> <span data-ttu-id="7e378-225">Gdy tylko użytkownik zamknie aplikację (żadne pozostałe karty lub okna aplikacji), nowy proces roboczy usługi zostanie *uaktywniony* i będzie używany do kolejnych odwiedzin aplikacji.</span><span class="sxs-lookup"><span data-stu-id="7e378-225">As soon as the user closes the app (no remaining app tabs or windows), the new service worker becomes *active* and is used for subsequent app visits.</span></span> <span data-ttu-id="7e378-226">Stary proces roboczy usługi i jego pamięć podręczna są usuwane.</span><span class="sxs-lookup"><span data-stu-id="7e378-226">The old service worker and its cache are deleted.</span></span>
* <span data-ttu-id="7e378-227">Jeśli proces nie zakończy się pomyślnie, nowe wystąpienie procesu roboczego usługi zostanie odrzucone.</span><span class="sxs-lookup"><span data-stu-id="7e378-227">If the process doesn't complete successfully, the new service worker instance is discarded.</span></span> <span data-ttu-id="7e378-228">Proces aktualizacji jest podejmowany ponownie na następnym odwiedzeniu użytkownika, gdy miejmy nadzieję klient ma lepsze połączenie sieciowe, które może zakończyć żądania.</span><span class="sxs-lookup"><span data-stu-id="7e378-228">The update process is attempted again on the user's next visit, when hopefully the client has a better network connection that can complete the requests.</span></span>

<span data-ttu-id="7e378-229">Dostosuj ten proces, edytując logikę procesu roboczego usługi.</span><span class="sxs-lookup"><span data-stu-id="7e378-229">Customize this process by editing the service worker logic.</span></span> <span data-ttu-id="7e378-230">Żadne z powyższych zachowań nie jest specyficzne dla programu Blazor , ale jest tylko domyślnym środowiskoem udostępnionym przez opcję szablonu PWA.</span><span class="sxs-lookup"><span data-stu-id="7e378-230">None of the preceding behavior is specific to Blazor but is merely the default experience provided by the PWA template option.</span></span> <span data-ttu-id="7e378-231">Aby uzyskać więcej informacji, zobacz [powiadomienia MDN Web docs: interfejs API procesu roboczego usługi](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span><span class="sxs-lookup"><span data-stu-id="7e378-231">For more information, see [MDN web docs: Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span></span>

### <a name="how-requests-are-resolved"></a><span data-ttu-id="7e378-232">Jak są rozwiązywane żądania</span><span class="sxs-lookup"><span data-stu-id="7e378-232">How requests are resolved</span></span>

<span data-ttu-id="7e378-233">Zgodnie z opisem w sekcji [Strategia pobierania pamięci podręcznej](#cache-first-fetch-strategy) , domyślny proces roboczy usługi korzysta z strategii dotyczącej *pamięci podręcznej* , co oznacza, że próbuje obsłużć zawartość buforowaną, jeśli jest dostępna.</span><span class="sxs-lookup"><span data-stu-id="7e378-233">As described in the [Cache-first fetch strategy](#cache-first-fetch-strategy) section, the default service worker uses a *cache-first* strategy, meaning that it tries to serve cached content when available.</span></span> <span data-ttu-id="7e378-234">W przypadku braku zawartości przechowywanej w pamięci podręcznej dla określonego adresu URL, na przykład podczas żądania danych z interfejsu API zaplecza, proces roboczy usługi powraca do zwykłego żądania sieci.</span><span class="sxs-lookup"><span data-stu-id="7e378-234">If there is no content cached for a certain URL, for example when requesting data from a backend API, the service worker falls back on a regular network request.</span></span> <span data-ttu-id="7e378-235">Żądanie sieciowe powiedzie się, jeśli serwer jest osiągalny.</span><span class="sxs-lookup"><span data-stu-id="7e378-235">The network request succeeds if the server is reachable.</span></span> <span data-ttu-id="7e378-236">Ta logika jest implementowana wewnątrz `onFetch` funkcji w ramach programu `service-worker.published.js` .</span><span class="sxs-lookup"><span data-stu-id="7e378-236">This logic is implemented inside `onFetch` function within `service-worker.published.js`.</span></span>

<span data-ttu-id="7e378-237">Jeśli Razor składniki aplikacji korzystają z żądania danych z interfejsów API zaplecza i chcesz zapewnić przyjazne środowisko użytkownika dla żądań zakończonych niepowodzeniem ze względu na niedostępność sieci, zaimplementuj logikę w składnikach aplikacji.</span><span class="sxs-lookup"><span data-stu-id="7e378-237">If the app's Razor components rely on requesting data from backend APIs and you want to provide a friendly user experience for failed requests due to network unavailability, implement logic within the app's components.</span></span> <span data-ttu-id="7e378-238">Na przykład użyj `try/catch` dookoła <xref:System.Net.Http.HttpClient> żądań.</span><span class="sxs-lookup"><span data-stu-id="7e378-238">For example, use `try/catch` around <xref:System.Net.Http.HttpClient> requests.</span></span>

### <a name="support-server-rendered-pages"></a><span data-ttu-id="7e378-239">Obsługa stron renderowanych na serwerze</span><span class="sxs-lookup"><span data-stu-id="7e378-239">Support server-rendered pages</span></span>

<span data-ttu-id="7e378-240">Zastanów się, co się stanie, gdy użytkownik po raz pierwszy przejdzie do adresu URL, takiego jak `/counter` lub dowolnego innego linku bezpośredniego w aplikacji.</span><span class="sxs-lookup"><span data-stu-id="7e378-240">Consider what happens when the user first navigates to a URL such as `/counter` or any other deep link in the app.</span></span> <span data-ttu-id="7e378-241">W takich przypadkach nie chcesz zwracać zawartości w pamięci podręcznej jako `/counter` , ale potrzebna jest przeglądarka do załadowania zawartości w pamięci podręcznej w `/index.html` celu uruchomienia Blazor WebAssembly aplikacji.</span><span class="sxs-lookup"><span data-stu-id="7e378-241">In these cases, you don't want to return content cached as `/counter`, but instead need the browser to load the content cached as `/index.html` to start up your Blazor WebAssembly app.</span></span> <span data-ttu-id="7e378-242">Te początkowe żądania są znane jako żądania *nawigacji* , w przeciwieństwie do:</span><span class="sxs-lookup"><span data-stu-id="7e378-242">These initial requests are known as *navigation* requests, as opposed to:</span></span>

* <span data-ttu-id="7e378-243">`subresource` żądania obrazów, arkuszy stylów lub innych plików.</span><span class="sxs-lookup"><span data-stu-id="7e378-243">`subresource` requests for images, stylesheets, or other files.</span></span>
* <span data-ttu-id="7e378-244">`fetch/XHR` żądania dotyczące danych interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="7e378-244">`fetch/XHR` requests for API data.</span></span>

<span data-ttu-id="7e378-245">Domyślny proces roboczy usługi zawiera logikę przypadków specjalnych dla żądań nawigacji.</span><span class="sxs-lookup"><span data-stu-id="7e378-245">The default service worker contains special-case logic for navigation requests.</span></span> <span data-ttu-id="7e378-246">Proces roboczy usługi rozwiązuje żądania, zwracając zawartość z pamięci podręcznej dla `/index.html` , niezależnie od żądanego adresu URL.</span><span class="sxs-lookup"><span data-stu-id="7e378-246">The service worker resolves the requests by returning the cached content for `/index.html`, regardless of the requested URL.</span></span> <span data-ttu-id="7e378-247">Ta logika jest implementowana w `onFetch` funkcji wewnątrz `service-worker.published.js` .</span><span class="sxs-lookup"><span data-stu-id="7e378-247">This logic is implemented in the `onFetch` function inside `service-worker.published.js`.</span></span>

<span data-ttu-id="7e378-248">Jeśli aplikacja ma określone adresy URL, które muszą zwracać kod HTML renderowany przez serwer, a nie `/index.html` z pamięci podręcznej, należy edytować logikę w procesie roboczym usługi.</span><span class="sxs-lookup"><span data-stu-id="7e378-248">If your app has certain URLs that must return server-rendered HTML, and not serve `/index.html` from the cache, then you need to edit the logic in your service worker.</span></span> <span data-ttu-id="7e378-249">Jeśli wszystkie adresy URL zawierające `/Identity/` muszą być obsługiwane jako zwykłe żądania tylko online do serwera, należy zmodyfikować `service-worker.published.js` `onFetch` logikę.</span><span class="sxs-lookup"><span data-stu-id="7e378-249">If all URLs containing `/Identity/` need to be handled as regular online-only requests to the server, then modify `service-worker.published.js` `onFetch` logic.</span></span> <span data-ttu-id="7e378-250">Znajdź następujący kod:</span><span class="sxs-lookup"><span data-stu-id="7e378-250">Locate the following code:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate';
```

<span data-ttu-id="7e378-251">Zmień kod na następujący:</span><span class="sxs-lookup"><span data-stu-id="7e378-251">Change the code to the following:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate'
  && !event.request.url.includes('/Identity/');
```

<span data-ttu-id="7e378-252">W przeciwnym razie niezależnie od łączności sieciowej proces roboczy usługi przechwytuje żądania dotyczące takich adresów URL i rozwiązuje je za pomocą polecenia `/index.html` .</span><span class="sxs-lookup"><span data-stu-id="7e378-252">If you don't do this, then regardless of network connectivity, the service worker intercepts requests for such URLs and resolves them using `/index.html`.</span></span>

<span data-ttu-id="7e378-253">Dodaj dodatkowe punkty końcowe dla zewnętrznych dostawców uwierzytelniania do sprawdzenia.</span><span class="sxs-lookup"><span data-stu-id="7e378-253">Add additional endpoints for external authentication providers to the check.</span></span> <span data-ttu-id="7e378-254">W poniższym przykładzie w `/signin-google` przypadku uwierzytelniania Google do sprawdzenia zostanie dodany:</span><span class="sxs-lookup"><span data-stu-id="7e378-254">In the following example, `/signin-google` for Google authentication is added to the check:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate'
  && !event.request.url.includes('/Identity/')
  && !event.request.url.includes('/signin-google');
```

<span data-ttu-id="7e378-255">Nie jest wymagana żadna akcja dla środowiska programistycznego, w którym zawartość jest zawsze pobierana z sieci.</span><span class="sxs-lookup"><span data-stu-id="7e378-255">No action is required for the Development environment, where content is always fetched from the network.</span></span>

### <a name="control-asset-caching"></a><span data-ttu-id="7e378-256">Sterowanie buforowaniem zasobów</span><span class="sxs-lookup"><span data-stu-id="7e378-256">Control asset caching</span></span>

<span data-ttu-id="7e378-257">Jeśli projekt definiuje Właściwość programu `ServiceWorkerAssetsManifest` MSBuild, Blazor narzędzia kompilacji generują manifest zasobów procesów roboczych usługi o określonej nazwie.</span><span class="sxs-lookup"><span data-stu-id="7e378-257">If your project defines the `ServiceWorkerAssetsManifest` MSBuild property, Blazor's build tooling generates a service worker assets manifest with the specified name.</span></span> <span data-ttu-id="7e378-258">Domyślny szablon PWA tworzy plik projektu zawierający następującą właściwość:</span><span class="sxs-lookup"><span data-stu-id="7e378-258">The default PWA template produces a project file containing the following property:</span></span>

```xml
<ServiceWorkerAssetsManifest>service-worker-assets.js</ServiceWorkerAssetsManifest>
```

<span data-ttu-id="7e378-259">Plik zostanie umieszczony w `wwwroot` katalogu wyjściowym, dzięki czemu przeglądarka może pobrać ten plik przez żądanie `/service-worker-assets.js` .</span><span class="sxs-lookup"><span data-stu-id="7e378-259">The file is placed in the `wwwroot` output directory, so the browser can retrieve this file by requesting `/service-worker-assets.js`.</span></span> <span data-ttu-id="7e378-260">Aby wyświetlić zawartość tego pliku, Otwórz `/bin/Debug/{TARGET FRAMEWORK}/wwwroot/service-worker-assets.js` w edytorze tekstu.</span><span class="sxs-lookup"><span data-stu-id="7e378-260">To see the contents of this file, open `/bin/Debug/{TARGET FRAMEWORK}/wwwroot/service-worker-assets.js` in a text editor.</span></span> <span data-ttu-id="7e378-261">Jednak nie należy edytować pliku, ponieważ jest on ponownie generowany dla każdej kompilacji.</span><span class="sxs-lookup"><span data-stu-id="7e378-261">However, don't edit the file, as it's regenerated on each build.</span></span>

<span data-ttu-id="7e378-262">Domyślnie ten manifest zawiera następujące listę:</span><span class="sxs-lookup"><span data-stu-id="7e378-262">By default, this manifest lists:</span></span>

* <span data-ttu-id="7e378-263">Wszelkie Blazor zarządzane zasoby, takie jak zestawy .NET i pliki środowiska uruchomieniowego Webassembly programu .NET, są wymagane do działania w trybie offline.</span><span class="sxs-lookup"><span data-stu-id="7e378-263">Any Blazor-managed resources, such as .NET assemblies and the .NET WebAssembly runtime files required to function offline.</span></span>
* <span data-ttu-id="7e378-264">Wszystkie zasoby do publikowania w `wwwroot` katalogu aplikacji, takie jak obrazy, arkusze stylów i pliki JavaScript, w tym statyczne zasoby sieci Web dostarczane przez zewnętrzne projekty i pakiety NuGet.</span><span class="sxs-lookup"><span data-stu-id="7e378-264">All resources for publishing to the app's `wwwroot` directory, such as images, stylesheets, and JavaScript files, including static web assets supplied by external projects and NuGet packages.</span></span>

<span data-ttu-id="7e378-265">Można kontrolować, które z tych zasobów są pobierane i buforowane przez proces roboczy usługi przez edytowanie logiki w `onInstall` programie w ramach programu `service-worker.published.js` .</span><span class="sxs-lookup"><span data-stu-id="7e378-265">You can control which of these resources are fetched and cached by the service worker by editing the logic in `onInstall` in `service-worker.published.js`.</span></span> <span data-ttu-id="7e378-266">Domyślnie proces roboczy usługi pobiera i buforuje pliki zgodne z typowymi rozszerzeniami nazw sieci Web, takimi jak `.html` ,, `.css` `.js` , i oraz `.wasm` typami plików specyficznymi dla Blazor WebAssembly ( `.dll` , `.pdb` ).</span><span class="sxs-lookup"><span data-stu-id="7e378-266">By default, the service worker fetches and caches files matching typical web filename extensions such as `.html`, `.css`, `.js`, and `.wasm`, plus file types specific to Blazor WebAssembly (`.dll`, `.pdb`).</span></span>

<span data-ttu-id="7e378-267">Aby uwzględnić dodatkowe zasoby, które nie znajdują się w `wwwroot` katalogu aplikacji, Zdefiniuj dodatkowe `ItemGroup` wpisy programu MSBuild, jak pokazano w następującym przykładzie:</span><span class="sxs-lookup"><span data-stu-id="7e378-267">To include additional resources that aren't present in the app's `wwwroot` directory, define extra MSBuild `ItemGroup` entries, as shown in the following example:</span></span>

```xml
<ItemGroup>
  <ServiceWorkerAssetsManifestItem Include="MyDirectory\AnotherFile.json"
    RelativePath="MyDirectory\AnotherFile.json" AssetUrl="files/AnotherFile.json" />
</ItemGroup>
```

<span data-ttu-id="7e378-268">`AssetUrl`Metadane określają podstawowy adres URL, który powinien być używany przez przeglądarkę podczas pobierania zasobu do pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="7e378-268">The `AssetUrl` metadata specifies the base-relative URL that the browser should use when fetching the resource to cache.</span></span> <span data-ttu-id="7e378-269">Może to być niezależna od oryginalnej nazwy pliku źródłowego na dysku.</span><span class="sxs-lookup"><span data-stu-id="7e378-269">This can be independent of its original source file name on disk.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="7e378-270">Dodanie elementu `ServiceWorkerAssetsManifestItem` nie powoduje opublikowania pliku w `wwwroot` katalogu aplikacji.</span><span class="sxs-lookup"><span data-stu-id="7e378-270">Adding a `ServiceWorkerAssetsManifestItem` doesn't cause the file to be published in the app's `wwwroot` directory.</span></span> <span data-ttu-id="7e378-271">Publikowanie danych wyjściowych musi być kontrolowane osobno.</span><span class="sxs-lookup"><span data-stu-id="7e378-271">The publish output must be controlled separately.</span></span> <span data-ttu-id="7e378-272">`ServiceWorkerAssetsManifestItem`Powoduje to jedynie wprowadzenie dodatkowego wpisu w manifeście zasobów procesu roboczego usługi.</span><span class="sxs-lookup"><span data-stu-id="7e378-272">The `ServiceWorkerAssetsManifestItem` only causes an additional entry to appear in the service worker assets manifest.</span></span>

## <a name="push-notifications"></a><span data-ttu-id="7e378-273">Powiadomienia wypychane</span><span class="sxs-lookup"><span data-stu-id="7e378-273">Push notifications</span></span>

<span data-ttu-id="7e378-274">Podobnie jak w przypadku innych aplikacji PWA, Blazor WebAssembly PWA może odbierać powiadomienia wypychane z serwera wewnętrznej bazy danych.</span><span class="sxs-lookup"><span data-stu-id="7e378-274">Like any other PWA, a Blazor WebAssembly PWA can receive push notifications from a backend server.</span></span> <span data-ttu-id="7e378-275">Serwer może wysyłać powiadomienia wypychane w dowolnym momencie, nawet jeśli użytkownik nie korzysta aktywnie z aplikacji.</span><span class="sxs-lookup"><span data-stu-id="7e378-275">The server can send push notifications at any time, even when the user isn't actively using the app.</span></span> <span data-ttu-id="7e378-276">Na przykład powiadomienia wypychane mogą być wysyłane, gdy inny użytkownik wykonuje odpowiednią akcję.</span><span class="sxs-lookup"><span data-stu-id="7e378-276">For example, push notifications can be sent when a different user performs a relevant action.</span></span>

<span data-ttu-id="7e378-277">Mechanizm wysyłania powiadomień wypychanych jest całkowicie niezależny od Blazor WebAssembly , ponieważ jest zaimplementowany przez serwer wewnętrznej bazy danych, który może korzystać z dowolnej technologii.</span><span class="sxs-lookup"><span data-stu-id="7e378-277">The mechanism for sending a push notification is entirely independent of Blazor WebAssembly, since it's implemented by the backend server which can use any technology.</span></span> <span data-ttu-id="7e378-278">Jeśli chcesz wysyłać powiadomienia wypychane z serwera ASP.NET Core, rozważ [użycie techniki podobnej do podejścia wykonywanego w warsztatie niezwykle Pizza](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications).</span><span class="sxs-lookup"><span data-stu-id="7e378-278">If you want to send push notifications from an ASP.NET Core server, consider [using a technique similar to the approach taken in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications).</span></span>

<span data-ttu-id="7e378-279">Mechanizm otrzymywania i wyświetlania powiadomień wypychanych na kliencie jest również niezależny od Blazor WebAssembly , ponieważ jest zaimplementowany w pliku JavaScript procesu roboczego usługi.</span><span class="sxs-lookup"><span data-stu-id="7e378-279">The mechanism for receiving and displaying a push notification on the client is also independent of Blazor WebAssembly, since it's implemented in the service worker JavaScript file.</span></span> <span data-ttu-id="7e378-280">Aby zapoznać się z przykładem, zapoznaj [się z podejściem używanym w warsztatie niezwykle Pizza](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications).</span><span class="sxs-lookup"><span data-stu-id="7e378-280">For an example, see [the approach used in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications).</span></span>

## <a name="caveats-for-offline-pwas"></a><span data-ttu-id="7e378-281">Ostrzeżenia dotyczące PWAs w trybie offline</span><span class="sxs-lookup"><span data-stu-id="7e378-281">Caveats for offline PWAs</span></span>

<span data-ttu-id="7e378-282">Nie wszystkie aplikacje powinny próbować obsługiwać użycie w trybie offline.</span><span class="sxs-lookup"><span data-stu-id="7e378-282">Not all apps should attempt to support offline use.</span></span> <span data-ttu-id="7e378-283">Obsługa offline zwiększa znaczącą złożoność, ale nie zawsze jest istotna dla wymaganych przypadków użycia.</span><span class="sxs-lookup"><span data-stu-id="7e378-283">Offline support adds significant complexity, while not always being relevant for the use cases required.</span></span>

<span data-ttu-id="7e378-284">Obsługa w trybie offline jest zwykle istotna:</span><span class="sxs-lookup"><span data-stu-id="7e378-284">Offline support is usually relevant only:</span></span>

* <span data-ttu-id="7e378-285">Jeśli podstawowy magazyn danych jest lokalny dla przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="7e378-285">If the primary data store is local to the browser.</span></span> <span data-ttu-id="7e378-286">Na przykład podejście jest istotne w aplikacji z interfejsem użytkownika dla urządzenia [IoT](https://en.wikipedia.org/wiki/Internet_of_things) , które przechowuje dane w programie `localStorage` lub [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span><span class="sxs-lookup"><span data-stu-id="7e378-286">For example, the approach is relevant in an app with a UI for an [IoT](https://en.wikipedia.org/wiki/Internet_of_things) device that stores data in `localStorage` or [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span></span>
* <span data-ttu-id="7e378-287">Jeśli aplikacja wykonuje znaczną ilość pracy, aby pobrać i buforować dane interfejsu API zaplecza odpowiednie dla każdego użytkownika, aby mogły nawigować przez dane w trybie offline.</span><span class="sxs-lookup"><span data-stu-id="7e378-287">If the app performs a significant amount of work to fetch and cache the backend API data relevant to each user so that they can navigate through the data offline.</span></span> <span data-ttu-id="7e378-288">Jeśli aplikacja musi obsługiwać edytowanie, należy skompilować system do śledzenia zmian i synchronizowania danych z zapleczem.</span><span class="sxs-lookup"><span data-stu-id="7e378-288">If the app must support editing, a system for tracking changes and synchronizing data with the backend must be built.</span></span>
* <span data-ttu-id="7e378-289">Jeśli celem jest zagwarantowanie, że aplikacja zostanie załadowana natychmiast niezależnie od warunków sieci.</span><span class="sxs-lookup"><span data-stu-id="7e378-289">If the goal is to guarantee that the app loads immediately regardless of network conditions.</span></span> <span data-ttu-id="7e378-290">Zaimplementuj odpowiednie środowisko użytkownika wokół żądań interfejsu API zaplecza, aby pokazać postęp żądań i zachowywać się bezproblemowo, gdy żądania nie powiodą się z powodu niedostępności sieci.</span><span class="sxs-lookup"><span data-stu-id="7e378-290">Implement a suitable user experience around backend API requests to show the progress of requests and behave gracefully when requests fail due to network unavailability.</span></span>

<span data-ttu-id="7e378-291">Ponadto PWAs z obsługą trybu offline muszą odnosić się do szeregu dodatkowych komplikacji.</span><span class="sxs-lookup"><span data-stu-id="7e378-291">Additionally, offline-capable PWAs must deal with a range of additional complications.</span></span> <span data-ttu-id="7e378-292">Deweloperzy powinni uważnie zaznajomić się z zastrzeżeniami w poniższych sekcjach.</span><span class="sxs-lookup"><span data-stu-id="7e378-292">Developers should carefully familiarize themselves with the caveats in the following sections.</span></span>

### <a name="offline-support-only-when-published"></a><span data-ttu-id="7e378-293">Obsługa offline tylko po opublikowaniu</span><span class="sxs-lookup"><span data-stu-id="7e378-293">Offline support only when published</span></span>

<span data-ttu-id="7e378-294">Podczas opracowywania zwykle chcesz zobaczyć, że wszystkie zmiany zostaną odzwierciedlone bezpośrednio w przeglądarce bez przechodzenia przez proces aktualizacji w tle.</span><span class="sxs-lookup"><span data-stu-id="7e378-294">During development you typically want to see each change reflected immediately in the browser without going through a background update process.</span></span> <span data-ttu-id="7e378-295">W związku z tym Blazor szablon PWA umożliwia obsługę offline tylko po opublikowaniu.</span><span class="sxs-lookup"><span data-stu-id="7e378-295">Therefore, Blazor's PWA template enables offline support only when published.</span></span>

<span data-ttu-id="7e378-296">Podczas kompilowania aplikacji z obsługą trybu offline nie wystarczy przetestować aplikacji w środowisku deweloperskim.</span><span class="sxs-lookup"><span data-stu-id="7e378-296">When building an offline-capable app, it's not enough to test the app in the Development environment.</span></span> <span data-ttu-id="7e378-297">Aby zrozumieć, jak reagują na inne warunki sieci, należy przetestować aplikację w stanie opublikowanym.</span><span class="sxs-lookup"><span data-stu-id="7e378-297">You must test the app in its published state to understand how it responds to different network conditions.</span></span>

### <a name="update-completion-after-user-navigation-away-from-app"></a><span data-ttu-id="7e378-298">Aktualizowanie uzupełniania po nawigacji użytkownika z aplikacji</span><span class="sxs-lookup"><span data-stu-id="7e378-298">Update completion after user navigation away from app</span></span>

<span data-ttu-id="7e378-299">Aktualizacje nie zostaną ukończone, dopóki użytkownik nie wyjdzie z aplikacji na wszystkich kartach.</span><span class="sxs-lookup"><span data-stu-id="7e378-299">Updates don't complete until the user has navigated away from the app in all tabs.</span></span> <span data-ttu-id="7e378-300">Zgodnie z opisem w sekcji [aktualizacje w tle](#background-updates) po wdrożeniu aktualizacji aplikacji przeglądarka pobiera zaktualizowane pliki procesów roboczych usługi, aby rozpocząć proces aktualizacji.</span><span class="sxs-lookup"><span data-stu-id="7e378-300">As explained in the [Background updates](#background-updates) section, after you deploy an update to the app, the browser fetches the updated service worker files to begin the update process.</span></span>

<span data-ttu-id="7e378-301">Co się stało z wieloma deweloperami, nawet po zakończeniu tej aktualizacji **nie zacznie obowiązywać** , dopóki użytkownik nie przejdzie na wszystkie karty.</span><span class="sxs-lookup"><span data-stu-id="7e378-301">What surprises many developers is that, even when this update completes, it does **not** take effect until the user has navigated away in all tabs.</span></span> <span data-ttu-id="7e378-302">Odświeżenie karty wyświetlającej aplikację **nie** jest wystarczające, nawet jeśli jest to jedyna karta wyświetlająca aplikację.</span><span class="sxs-lookup"><span data-stu-id="7e378-302">It is **not** sufficient to refresh the tab displaying the app, even if it's the only tab displaying the app.</span></span> <span data-ttu-id="7e378-303">Dopóki aplikacja nie zostanie całkowicie ZAMKNIĘTA, nowy proces roboczy usługi pozostaje w stanie *oczekiwania na aktywację* .</span><span class="sxs-lookup"><span data-stu-id="7e378-303">Until your app is completely closed, the new service worker remains in the *waiting to activate* status.</span></span> <span data-ttu-id="7e378-304">**Nie jest to specyficzne dla Blazor , ale raczej jest standardowe zachowanie platformy sieci Web.**</span><span class="sxs-lookup"><span data-stu-id="7e378-304">**This is not specific to Blazor, but rather is a standard web platform behavior.**</span></span>

<span data-ttu-id="7e378-305">Jest to często spowodowane przez deweloperów, którzy próbują przetestować aktualizacje do swoich procesów roboczych lub zasobów w pamięci podręcznej w trybie offline.</span><span class="sxs-lookup"><span data-stu-id="7e378-305">This commonly troubles developers who are trying to test updates to their service worker or offline cached resources.</span></span> <span data-ttu-id="7e378-306">W przypadku zaewidencjonowania narzędzi deweloperskich w przeglądarce można zobaczyć podobne do następujących:</span><span class="sxs-lookup"><span data-stu-id="7e378-306">If you check in the browser's developer tools, you may see something like the following:</span></span>

![Karta Google Chrome "aplikacja" pokazuje, że proces roboczy usługi aplikacji to "Oczekiwanie na aktywację".](progressive-web-app/_static/image7.png)

<span data-ttu-id="7e378-308">Tak długo, jak lista "klientów", które są kartami lub oknami wyświetlanymi w aplikacji, nie jest pusta, proces roboczy kontynuuje oczekiwanie.</span><span class="sxs-lookup"><span data-stu-id="7e378-308">For as long as the list of "clients," which are tabs or windows displaying your app, is nonempty, the worker continues waiting.</span></span> <span data-ttu-id="7e378-309">Przyczyną tego jest zagwarantowanie spójności przez pracowników.</span><span class="sxs-lookup"><span data-stu-id="7e378-309">The reason service workers do this is to guarantee consistency.</span></span> <span data-ttu-id="7e378-310">Spójność oznacza, że wszystkie zasoby są pobierane z tej samej niepodzielnej pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="7e378-310">Consistency means that all resources are fetched from the same atomic cache.</span></span>

<span data-ttu-id="7e378-311">Podczas testowania zmian może być przydatne kliknięcie linku "skipWaiting", jak pokazano na poprzednim zrzucie ekranu, a następnie ponowne załadowanie strony.</span><span class="sxs-lookup"><span data-stu-id="7e378-311">When testing changes, you may find it convenient to click the "skipWaiting" link as shown in the preceding screenshot, then reload the page.</span></span> <span data-ttu-id="7e378-312">Możesz zautomatyzować ten proces dla wszystkich użytkowników, napisanie przez siebie procesu roboczego usługi w celu [pominięcia fazy "oczekiwanie" i natychmiastowej aktywacji przy aktualizacji](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span><span class="sxs-lookup"><span data-stu-id="7e378-312">You can automate this for all users by coding your service worker to [skip the "waiting" phase and immediately activate on update](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span></span> <span data-ttu-id="7e378-313">W przypadku pominięcia fazy oczekiwania zostanie nadana gwarancja, że zasoby są zawsze pobierane spójnie z tego samego wystąpienia pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="7e378-313">If you skip the waiting phase, you're giving up the guarantee that resources are always fetched consistently from the same cache instance.</span></span>

### <a name="users-may-run-any-historical-version-of-the-app"></a><span data-ttu-id="7e378-314">Użytkownicy mogą uruchamiać dowolną wersję historyczną aplikacji</span><span class="sxs-lookup"><span data-stu-id="7e378-314">Users may run any historical version of the app</span></span>

<span data-ttu-id="7e378-315">Deweloperzy sieci Web zwykle oczekują, że użytkownicy uruchamiają tylko najnowszą wdrożoną wersję aplikacji sieci Web, ponieważ jest ona normalna w ramach tradycyjnego modelu dystrybucji sieci Web.</span><span class="sxs-lookup"><span data-stu-id="7e378-315">Web developers habitually expect that users only run the latest deployed version of their web app, since that's normal within the traditional web distribution model.</span></span> <span data-ttu-id="7e378-316">Jednak w trybie offline — w pierwszej kolejności program PWA jest bardziej zbliżone w natywnej aplikacji mobilnej, w której użytkownicy nie muszą uruchamiać najnowszej wersji.</span><span class="sxs-lookup"><span data-stu-id="7e378-316">However, an offline-first PWA is more akin to a native mobile app, where users aren't necessarily running the latest version.</span></span>

<span data-ttu-id="7e378-317">Zgodnie z opisem w sekcji [aktualizacje w tle](#background-updates) , po wdrożeniu aktualizacji aplikacji, **każdy istniejący użytkownik nadal używa poprzedniej wersji dla co najmniej jednej kolejnej odwiedzania** , ponieważ aktualizacja występuje w tle i nie jest aktywowana, dopóki użytkownik nie wyjdzie dalej.</span><span class="sxs-lookup"><span data-stu-id="7e378-317">As explained in the [Background updates](#background-updates) section, after you deploy an update to your app, **each existing user continues to use a previous version for at least one further visit** because the update occurs in the background and isn't activated until the user thereafter navigates away.</span></span> <span data-ttu-id="7e378-318">Ponadto użyta Poprzednia wersja nie jest konieczna od poprzedniej wdrożonej wersji.</span><span class="sxs-lookup"><span data-stu-id="7e378-318">Plus, the previous version being used isn't necessarily the previous one you deployed.</span></span> <span data-ttu-id="7e378-319">Poprzednią wersją może być *dowolna* wersja historyczna, w zależności od tego, kiedy użytkownik ostatnio ukończył aktualizację.</span><span class="sxs-lookup"><span data-stu-id="7e378-319">The previous version can be *any* historical version, depending on when the user last completed an update.</span></span>

<span data-ttu-id="7e378-320">Może to być problemem, jeśli składniki frontonu i zaplecza aplikacji wymagają umowy dotyczącej schematu dla żądań interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="7e378-320">This can be an issue if the frontend and backend parts of your app require agreement about the schema for API requests.</span></span> <span data-ttu-id="7e378-321">Nie należy wdrażać zmian schematu interfejsu API bez zgodności z poprzednimi wersjami, dopóki nie będzie można upewnić się, że wszyscy użytkownicy zostali zaktualizowani.</span><span class="sxs-lookup"><span data-stu-id="7e378-321">You must not deploy backward-incompatible API schema changes until you can be sure that all users have upgraded.</span></span> <span data-ttu-id="7e378-322">Alternatywnie Zablokuj użytkownikom możliwość korzystania ze starszych wersji aplikacji.</span><span class="sxs-lookup"><span data-stu-id="7e378-322">Alternatively, block users from using incompatible older versions of the app.</span></span> <span data-ttu-id="7e378-323">To wymaganie jest takie samo jak w przypadku natywnych aplikacji mobilnych.</span><span class="sxs-lookup"><span data-stu-id="7e378-323">This scenario requirement is the same as for native mobile apps.</span></span> <span data-ttu-id="7e378-324">W przypadku wdrożenia istotnej zmiany w interfejsach API serwera aplikacja kliencka jest uszkodzona dla użytkowników, którzy jeszcze nie zostali zaktualizowani.</span><span class="sxs-lookup"><span data-stu-id="7e378-324">If you deploy a breaking change in server APIs, the client app is broken for users who haven't yet updated.</span></span>

<span data-ttu-id="7e378-325">Jeśli to możliwe, nie Wdrażaj istotnych zmian w interfejsach API zaplecza.</span><span class="sxs-lookup"><span data-stu-id="7e378-325">If possible, don't deploy breaking changes to your backend APIs.</span></span> <span data-ttu-id="7e378-326">Jeśli to konieczne, należy rozważyć użycie [standardowych interfejsów API procesów roboczych, takich jak ServiceWorkerRegistration](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) , aby określić, czy aplikacja jest aktualna, a jeśli nie, aby uniknąć użycia.</span><span class="sxs-lookup"><span data-stu-id="7e378-326">If you must do so, consider using [standard Service Worker APIs such as ServiceWorkerRegistration](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) to determine whether the app is up-to-date, and if not, to prevent usage.</span></span>

### <a name="interference-with-server-rendered-pages"></a><span data-ttu-id="7e378-327">Zakłócenia przy użyciu stron renderowanych na serwerze</span><span class="sxs-lookup"><span data-stu-id="7e378-327">Interference with server-rendered pages</span></span>

<span data-ttu-id="7e378-328">Zgodnie z opisem w sekcji [strony obsługi renderowanej przez serwer](#support-server-rendered-pages) , jeśli chcesz ominąć zachowanie funkcji przez proces roboczy usługi zwracające `/index.html` zawartość dla wszystkich żądań nawigacji, Edytuj logikę w procesie roboczym usługi.</span><span class="sxs-lookup"><span data-stu-id="7e378-328">As described in the [Support server-rendered pages](#support-server-rendered-pages) section, if you want to bypass the service worker's behavior of returning `/index.html` contents for all navigation requests, edit the logic in your service worker.</span></span>

### <a name="all-service-worker-asset-manifest-contents-are-cached-by-default"></a><span data-ttu-id="7e378-329">Zawartość manifestu wszystkich zasobów procesu roboczego usługi jest domyślnie buforowana</span><span class="sxs-lookup"><span data-stu-id="7e378-329">All service worker asset manifest contents are cached by default</span></span>

<span data-ttu-id="7e378-330">Zgodnie z opisem w sekcji [buforowanie zasobów kontroli](#control-asset-caching) plik `service-worker-assets.js` jest generowany podczas kompilacji i zawiera listę wszystkich zasobów, które pracownik usług powinien pobrać i buforować.</span><span class="sxs-lookup"><span data-stu-id="7e378-330">As described in the [Control asset caching](#control-asset-caching) section, the file `service-worker-assets.js` is generated during build and lists all assets the service worker should fetch and cache.</span></span>

<span data-ttu-id="7e378-331">Ponieważ ta lista domyślnie zawiera wszystkie informacje, które są emitowane do `wwwroot` , w tym zawartość dostarczaną przez zewnętrzne pakiety i projekty, należy zachować ostrożność, aby nie umieścić zbyt dużej ilości zawartości.</span><span class="sxs-lookup"><span data-stu-id="7e378-331">Since this list by default includes everything emitted to `wwwroot`, including content supplied by external packages and projects, you must be careful not to put too much content there.</span></span> <span data-ttu-id="7e378-332">Jeśli `wwwroot` katalog zawiera miliony obrazów, proces roboczy usługi próbuje pobrać i buforować je wszystkie, zużywać nadmierną przepustowość i prawdopodobnie nie zostanie pomyślnie zakończony.</span><span class="sxs-lookup"><span data-stu-id="7e378-332">If the `wwwroot` directory contains millions of images, the service worker tries to fetch and cache them all, consuming excessive bandwidth and most likely not completing successfully.</span></span>

<span data-ttu-id="7e378-333">Implementowanie dowolnej logiki w celu kontrolowania, który podzbiór zawartości manifestu powinien być pobierany i buforowany przez edycję `onInstall` funkcji w `service-worker.published.js` .</span><span class="sxs-lookup"><span data-stu-id="7e378-333">Implement arbitrary logic to control which subset of the manifest's contents should be fetched and cached by editing the `onInstall` function in `service-worker.published.js`.</span></span>

### <a name="interaction-with-authentication"></a><span data-ttu-id="7e378-334">Interakcja z uwierzytelnianiem</span><span class="sxs-lookup"><span data-stu-id="7e378-334">Interaction with authentication</span></span>

<span data-ttu-id="7e378-335">Szablon PWA może być używany w połączeniu z uwierzytelnianiem.</span><span class="sxs-lookup"><span data-stu-id="7e378-335">The PWA template can be used in conjunction with authentication.</span></span> <span data-ttu-id="7e378-336">PWA obsługujący tryb offline może również obsługiwać uwierzytelnianie, gdy użytkownik ma początkową łączność sieciową.</span><span class="sxs-lookup"><span data-stu-id="7e378-336">An offline-capable PWA can also support authentication when the user has initial network connectivity.</span></span>

<span data-ttu-id="7e378-337">Jeśli użytkownik nie ma łączności sieciowej, nie może uwierzytelnić ani uzyskać tokenów dostępu.</span><span class="sxs-lookup"><span data-stu-id="7e378-337">When a user doesn't have network connectivity, they can't authenticate or obtain access tokens.</span></span> <span data-ttu-id="7e378-338">Domyślnie przy próbie odwiedzenia strony logowania bez dostępu do sieci następuje komunikat "błąd sieci".</span><span class="sxs-lookup"><span data-stu-id="7e378-338">By default, attempting to visit the login page without network access results in a "network error" message.</span></span> <span data-ttu-id="7e378-339">Musisz zaprojektować przepływ interfejsu użytkownika, który umożliwia użytkownikowi wykonywanie użytecznych zadań w trybie offline bez próby uwierzytelnienia użytkownika lub uzyskania tokenów dostępu.</span><span class="sxs-lookup"><span data-stu-id="7e378-339">You must design a UI flow that allows the user perform useful tasks while offline without attempting to authenticate the user or obtain access tokens.</span></span> <span data-ttu-id="7e378-340">Alternatywnie możesz zaprojektować aplikację, aby bezpiecznie kończyć się niepowodzeniem, gdy sieć jest niedostępna.</span><span class="sxs-lookup"><span data-stu-id="7e378-340">Alternatively, you can design the app to gracefully fail when the network isn't available.</span></span> <span data-ttu-id="7e378-341">Jeśli aplikacja nie może być zaprojektowana do obsługi tych scenariuszy, możesz nie włączyć obsługi w trybie offline.</span><span class="sxs-lookup"><span data-stu-id="7e378-341">If the app can't be designed to handle these scenarios, you might not want to enable offline support.</span></span>

<span data-ttu-id="7e378-342">Gdy aplikacja przeznaczona do użycia w trybie online i offline jest ponownie dostępna w trybie online:</span><span class="sxs-lookup"><span data-stu-id="7e378-342">When an app that's designed for online and offline use is online again:</span></span>

* <span data-ttu-id="7e378-343">Aplikacja może wymagać udostępnienia nowego tokenu dostępu.</span><span class="sxs-lookup"><span data-stu-id="7e378-343">The app might need to provision a new access token.</span></span>
* <span data-ttu-id="7e378-344">Aplikacja musi wykryć, czy inny użytkownik jest zalogowany w usłudze, aby mógł zastosować operacje do konta użytkownika, które zostały wprowadzone w trybie offline.</span><span class="sxs-lookup"><span data-stu-id="7e378-344">The app must detect if a different user is signed into the service so that it can apply operations to the user's account that were made while they were offline.</span></span>

<span data-ttu-id="7e378-345">Aby utworzyć aplikację w usłudze PWA w trybie offline, która współdziała z uwierzytelnianiem:</span><span class="sxs-lookup"><span data-stu-id="7e378-345">To create an offline PWA app that interacts with authentication:</span></span>

* <span data-ttu-id="7e378-346">Zastąp wartość <xref:Microsoft.AspNetCore.Components.WebAssembly.Authentication.AccountClaimsPrincipalFactory%601> fabryką, która przechowuje ostatniego zalogowanego użytkownika i używa przechowywanego użytkownika, gdy aplikacja jest w trybie offline.</span><span class="sxs-lookup"><span data-stu-id="7e378-346">Replace the <xref:Microsoft.AspNetCore.Components.WebAssembly.Authentication.AccountClaimsPrincipalFactory%601> with a factory that stores the last signed-in user and uses the stored user when the app is offline.</span></span>
* <span data-ttu-id="7e378-347">Operacje w kolejce, gdy aplikacja jest w trybie offline i stosuje je, gdy aplikacja wraca do trybu online.</span><span class="sxs-lookup"><span data-stu-id="7e378-347">Queue operations while the app is offline and apply them when the app returns online.</span></span>
* <span data-ttu-id="7e378-348">Podczas wylogowywania Wyczyść przechowywanego użytkownika.</span><span class="sxs-lookup"><span data-stu-id="7e378-348">During sign out, clear the stored user.</span></span>

<span data-ttu-id="7e378-349">[`CarChecker`](https://github.com/SteveSandersonMS/CarChecker)Przykładowa aplikacja pokazuje poprzednie metody.</span><span class="sxs-lookup"><span data-stu-id="7e378-349">The [`CarChecker`](https://github.com/SteveSandersonMS/CarChecker) sample app demonstrates the preceding approaches.</span></span> <span data-ttu-id="7e378-350">Zobacz następujące części aplikacji:</span><span class="sxs-lookup"><span data-stu-id="7e378-350">See the following parts of the app:</span></span>

* <span data-ttu-id="7e378-351">`OfflineAccountClaimsPrincipalFactory` (`Client/Data/OfflineAccountClaimsPrincipalFactory.cs`)</span><span class="sxs-lookup"><span data-stu-id="7e378-351">`OfflineAccountClaimsPrincipalFactory` (`Client/Data/OfflineAccountClaimsPrincipalFactory.cs`)</span></span>
* <span data-ttu-id="7e378-352">`LocalVehiclesStore` (`Client/Data/LocalVehiclesStore.cs`)</span><span class="sxs-lookup"><span data-stu-id="7e378-352">`LocalVehiclesStore` (`Client/Data/LocalVehiclesStore.cs`)</span></span>
* <span data-ttu-id="7e378-353">`LoginStatus` składnik ( `Client/Shared/LoginStatus.razor` )</span><span class="sxs-lookup"><span data-stu-id="7e378-353">`LoginStatus` component (`Client/Shared/LoginStatus.razor`)</span></span>

## <a name="additional-resources"></a><span data-ttu-id="7e378-354">Dodatkowe zasoby</span><span class="sxs-lookup"><span data-stu-id="7e378-354">Additional resources</span></span>

* [<span data-ttu-id="7e378-355">Rozwiązywanie problemów z integralnością skryptu programu PowerShell</span><span class="sxs-lookup"><span data-stu-id="7e378-355">Troubleshoot integrity PowerShell script</span></span>](xref:blazor/host-and-deploy/webassembly#troubleshoot-integrity-powershell-script)
* [<span data-ttu-id="7e378-356">SignalR negocjowanie między źródłami na potrzeby uwierzytelniania</span><span class="sxs-lookup"><span data-stu-id="7e378-356">SignalR cross-origin negotiation for authentication</span></span>](xref:blazor/fundamentals/additional-scenarios#signalr-cross-origin-negotiation-for-authentication)
