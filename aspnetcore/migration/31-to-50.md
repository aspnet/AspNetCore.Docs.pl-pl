---
title: Migruj z ASP.NET Core 3,1 do 5,0
author: scottaddie
description: Dowiedz się, jak migrować projekt ASP.NET Core 3,1 do ASP.NET Core 5,0.
ms.author: scaddie
ms.custom: mvc
ms.date: 12/02/2020
no-loc:
- appsettings.json
- ASP.NET Core Identity
- cookie
- Cookie
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: migration/31-to-50
ms.openlocfilehash: 00949acff9908b4a75b6604396876b9c6c41cb3a
ms.sourcegitcommit: 37186f76e4a50d7fb7389026dd0e5e234b51ebb2
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 02/04/2021
ms.locfileid: "99541358"
---
# <a name="migrate-from-aspnet-core-31-to-50"></a><span data-ttu-id="a6801-103">Migruj z ASP.NET Core 3,1 do 5,0</span><span class="sxs-lookup"><span data-stu-id="a6801-103">Migrate from ASP.NET Core 3.1 to 5.0</span></span>

<span data-ttu-id="a6801-104">Przez [Scott Addie](https://github.com/scottaddie)</span><span class="sxs-lookup"><span data-stu-id="a6801-104">By [Scott Addie](https://github.com/scottaddie)</span></span>

<span data-ttu-id="a6801-105">W tym artykule wyjaśniono, jak zaktualizować istniejący projekt ASP.NET Core 3,1 do ASP.NET Core 5,0.</span><span class="sxs-lookup"><span data-stu-id="a6801-105">This article explains how to update an existing ASP.NET Core 3.1 project to ASP.NET Core 5.0.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="a6801-106">Wymagania wstępne</span><span class="sxs-lookup"><span data-stu-id="a6801-106">Prerequisites</span></span>

# <a name="visual-studio"></a>[<span data-ttu-id="a6801-107">Program Visual Studio</span><span class="sxs-lookup"><span data-stu-id="a6801-107">Visual Studio</span></span>](#tab/visual-studio)

[!INCLUDE[](~/includes/net-core-prereqs-vs-5.0.md)]

# <a name="visual-studio-code"></a>[<span data-ttu-id="a6801-108">Visual Studio Code</span><span class="sxs-lookup"><span data-stu-id="a6801-108">Visual Studio Code</span></span>](#tab/visual-studio-code)

[!INCLUDE[](~/includes/net-core-prereqs-vsc-5.0.md)]

# <a name="visual-studio-for-mac"></a>[<span data-ttu-id="a6801-109">Visual Studio dla komputerów Mac</span><span class="sxs-lookup"><span data-stu-id="a6801-109">Visual Studio for Mac</span></span>](#tab/visual-studio-mac)

[!INCLUDE[](~/includes/net-core-prereqs-mac-5.0.md)]

---

## <a name="update-net-core-sdk-version-in-globaljson"></a><span data-ttu-id="a6801-110">Aktualizacja zestaw .NET Core SDK wersji w global.jsna</span><span class="sxs-lookup"><span data-stu-id="a6801-110">Update .NET Core SDK version in global.json</span></span>

<span data-ttu-id="a6801-111">Jeśli polegasz na [global.jspliku w](/dotnet/core/tools/global-json) celu wybrania konkretnej wersji zestaw .NET Core SDK, zaktualizuj `version` Właściwość do zainstalowanej wersji zestawu SDK programu .NET 5,0.</span><span class="sxs-lookup"><span data-stu-id="a6801-111">If you rely upon a [global.json](/dotnet/core/tools/global-json) file to target a specific .NET Core SDK version, update the `version` property to the .NET 5.0 SDK version that's installed.</span></span> <span data-ttu-id="a6801-112">Na przykład:</span><span class="sxs-lookup"><span data-stu-id="a6801-112">For example:</span></span>

```diff
{
  "sdk": {
-    "version": "3.1.200"
+    "version": "5.0.100"
  }
}
```

## <a name="update-the-target-framework"></a><span data-ttu-id="a6801-113">Aktualizowanie platformy docelowej</span><span class="sxs-lookup"><span data-stu-id="a6801-113">Update the target framework</span></span>

<span data-ttu-id="a6801-114">Jeśli aktualizujesz Blazor WebAssembly projekt, przejdź do sekcji [Aktualizowanie Blazor WebAssembly projektów](#update-blazor-webassembly-projects) .</span><span class="sxs-lookup"><span data-stu-id="a6801-114">If updating a Blazor WebAssembly project, skip to the [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) section.</span></span> <span data-ttu-id="a6801-115">W przypadku każdego innego typu projektu ASP.NET Core należy zaktualizować [moniker struktury docelowej (TFM)](/dotnet/standard/frameworks) pliku projektu do `net5.0` :</span><span class="sxs-lookup"><span data-stu-id="a6801-115">For any other ASP.NET Core project type, update the project file's [Target Framework Moniker (TFM)](/dotnet/standard/frameworks) to `net5.0`:</span></span>

```diff
<Project Sdk="Microsoft.NET.Sdk.Web">

  <PropertyGroup>
-    <TargetFramework>netcoreapp3.1</TargetFramework>
+    <TargetFramework>net5.0</TargetFramework>
  </PropertyGroup>

</Project>
```

## <a name="changes-to-blazor-app-routing-logic-in-501-and-further-5x-releases-up-to-60"></a><span data-ttu-id="a6801-116">Zmiany w Blazor logice routingu aplikacji w 5.0.1 i dalsze 5. x wydania do 6,0</span><span class="sxs-lookup"><span data-stu-id="a6801-116">Changes to Blazor app routing logic in 5.0.1 and further 5.x releases up to 6.0</span></span>

<span data-ttu-id="a6801-117">Obliczanie priorytetu trasy zostało zmienione w ASP.NET Core wydania poprawki 5.0.1.</span><span class="sxs-lookup"><span data-stu-id="a6801-117">The computation of route precedence changed in the ASP.NET Core 5.0.1 patch release.</span></span> <span data-ttu-id="a6801-118">Może to mieć wpływ na użytkownika, jeśli zdefiniowano wszystkie trasy lub trasy z parametrami opcjonalnymi.</span><span class="sxs-lookup"><span data-stu-id="a6801-118">This might affect you if you've defined catch-all routes or routes with optional parameters.</span></span>

### <a name="old-behavior"></a><span data-ttu-id="a6801-119">Stare zachowanie</span><span class="sxs-lookup"><span data-stu-id="a6801-119">Old behavior</span></span>

<span data-ttu-id="a6801-120">W przypadku wcześniejszego zachowania w ASP.NET Core 5.0.0 lub starszym trasy z niższym pierwszeństwem, takie jak `{*slug}` , są dopasowane przed trasami o wyższym priorytecie, na przykład `/customer/{id}` .</span><span class="sxs-lookup"><span data-stu-id="a6801-120">With the prior behavior in ASP.NET Core 5.0.0 or earlier, routes with lower precedence, such as `{*slug}`, are matched before routes with higher precedence, such as `/customer/{id}`.</span></span>

### <a name="new-behavior"></a><span data-ttu-id="a6801-121">Nowe zachowanie</span><span class="sxs-lookup"><span data-stu-id="a6801-121">New behavior</span></span>

<span data-ttu-id="a6801-122">Nowe zachowanie w ASP.NET Core 5.0.1 lub nowszej jest ściśle zgodne z zachowaniem routingu zdefiniowanym w ASP.NET Core aplikacjach, gdzie struktura oblicza i ustanawia pierwszeństwo tras dla każdego segmentu, a także używa długości trasy, aby zerwać powiązania jako kryterium pomocnicze.</span><span class="sxs-lookup"><span data-stu-id="a6801-122">The new behavior in ASP.NET Core 5.0.1 or later more closely matches the routing behavior defined in ASP.NET Core apps, where the framework computes and establishes the route precedence for each segment first and only uses the length of the route to break ties as a secondary criteria.</span></span>

### <a name="reason-for-change"></a><span data-ttu-id="a6801-123">Przyczyna zmiany</span><span class="sxs-lookup"><span data-stu-id="a6801-123">Reason for change</span></span>

<span data-ttu-id="a6801-124">Oryginalne zachowanie jest uznawane za usterkę w implementacji, ponieważ naszym celem jest zapełnienie Blazor systemu routingu w taki sam sposób jak w przypadku systemu routingu ASP.NET Core dla podzbioru funkcji obsługiwanych przez Blazor Routing.</span><span class="sxs-lookup"><span data-stu-id="a6801-124">The original behavior is considered a bug in the implementation because our goal is for the Blazor routing system to behave in the same way as the ASP.NET Core routing system for the subset of features supported by Blazor routing.</span></span>

### <a name="recommended-action"></a><span data-ttu-id="a6801-125">Zalecana akcja</span><span class="sxs-lookup"><span data-stu-id="a6801-125">Recommended action</span></span>

<span data-ttu-id="a6801-126">Dodaj `PreferExactMatches` atrybut do `Router` składnika w `App.razor` pliku, aby zadecydować o poprawnym zachowaniu:</span><span class="sxs-lookup"><span data-stu-id="a6801-126">Add the `PreferExactMatches` attribute to the `Router` component in the `App.razor` file to opt into the correct behavior:</span></span>

```razor
<Router AppAssembly="@typeof(Program).Assembly" PreferExactMatches="@true">
```

<span data-ttu-id="a6801-127">Gdy `PreferExactMatches` jest ustawiona na `@true` , dopasowanie trasy preferuje dokładne dopasowania w przypadku symboli wieloznacznych.</span><span class="sxs-lookup"><span data-stu-id="a6801-127">When `PreferExactMatches` is set to `@true`, route matching prefers exact matches over wildcards.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a6801-128">Wszystkie aplikacje powinny jawnie ustawić `PreferExactMatches` wartość `@true` .</span><span class="sxs-lookup"><span data-stu-id="a6801-128">All apps should explicitly set `PreferExactMatches` to `@true`.</span></span>
>
> <span data-ttu-id="a6801-129">Możliwość ustawienia `PreferExactMatches` `@false` lub pozostawienia tego ustawienia nie *jest dostępna tylko w celu zapewnienia zgodności z poprzednimi wersjami*.</span><span class="sxs-lookup"><span data-stu-id="a6801-129">The ability to set `PreferExactMatches` to `@false` or leave it unset *is only provided for backward compatibility*.</span></span>
>
> <span data-ttu-id="a6801-130">Po wydaniu programu .NET 6 router zawsze preferuje dokładne dopasowania i `PreferExactMatches` opcja nie będzie dostępna.</span><span class="sxs-lookup"><span data-stu-id="a6801-130">When .NET 6 is released, the router will always prefer exact matches, and the `PreferExactMatches` option won't be available.</span></span>

## <a name="update-blazor-webassembly-and-blazor-server-projects"></a><span data-ttu-id="a6801-131">Aktualizacja Blazor WebAssembly i Blazor Server projekty</span><span class="sxs-lookup"><span data-stu-id="a6801-131">Update Blazor WebAssembly and Blazor Server projects</span></span>

<span data-ttu-id="a6801-132">*Wskazówki zawarte w tej sekcji dotyczą obu Blazor modeli hostingu. Poniższe sekcje zawierają dodatkowe wskazówki dotyczące hostingu modeli i typów aplikacji. Zastosuj wskazówki ze wszystkich odpowiednich sekcji do aplikacji.*</span><span class="sxs-lookup"><span data-stu-id="a6801-132">*The guidance in this section applies to both Blazor hosting models. Sections following this section provide additional guidance specific to hosting models and app types. Apply the guidance from all relevant sections to your app.*</span></span>

1. <span data-ttu-id="a6801-133">W `wwwroot/index.html` Blazor WebAssembly aplikacji lub `Pages/_Host.cshtml` Blazor Server aplikacji, Dodaj `<link>` element do `<head>` elementu style.</span><span class="sxs-lookup"><span data-stu-id="a6801-133">In `wwwroot/index.html` of a Blazor WebAssembly app or the `Pages/_Host.cshtml` of a Blazor Server app, add a `<link>` element to the `<head>` element for styles.</span></span> <span data-ttu-id="a6801-134">W poniższych `<link>` `href` wartości atrybutów elementu symbol zastępczy `{ASSEMBLY NAME}` jest nazwą zestawu aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a6801-134">In the following `<link>` element `href` attribute values, the placeholder `{ASSEMBLY NAME}` is the app's assembly name.</span></span>

    ```diff
    +<link href="{ASSEMBLY NAME}.styles.css" rel="stylesheet" />
    ```

    <span data-ttu-id="a6801-135">Autonomiczny Blazor WebAssembly lub Blazor Server przykład:</span><span class="sxs-lookup"><span data-stu-id="a6801-135">Standalone Blazor WebAssembly or Blazor Server example:</span></span>

    ```diff
    +<link href="BlazorSample.styles.css" rel="stylesheet" />
    ```

    <span data-ttu-id="a6801-136">*`Client`* projekt Blazor WebAssembly przykładowego rozwiązania hostowanego:</span><span class="sxs-lookup"><span data-stu-id="a6801-136">*`Client`* project of a hosted Blazor WebAssembly solution example:</span></span>

    ```diff
    +<link href="BlazorSample.Client.styles.css" rel="stylesheet" />
    ```

1. <span data-ttu-id="a6801-137">Dołącz nową przestrzeń nazw do `_Imports.razor` pliku aplikacji na potrzeby [wirtualizacji składników](xref:blazor/components/virtualization) <xref:Microsoft.AspNetCore.Components.Web.Virtualization?displayProperty=fullName> .</span><span class="sxs-lookup"><span data-stu-id="a6801-137">Include a new namespace in the app's `_Imports.razor` file for [component virtualization](xref:blazor/components/virtualization), <xref:Microsoft.AspNetCore.Components.Web.Virtualization?displayProperty=fullName>.</span></span> <span data-ttu-id="a6801-138">Następujące `_Imports.razor` pliki pokazują domyślne przestrzenie nazw w aplikacjach generowanych na podstawie Blazor szablonów projektu.</span><span class="sxs-lookup"><span data-stu-id="a6801-138">The following `_Imports.razor` files show the default namespaces in apps generated from the Blazor project templates.</span></span> <span data-ttu-id="a6801-139">Symbol zastępczy `{ASSEMBLY NAME}` jest nazwą zestawu aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a6801-139">The placeholder `{ASSEMBLY NAME}` is the app's assembly name.</span></span>

   <span data-ttu-id="a6801-140">Blazor WebAssembly (`_Imports.razor`):</span><span class="sxs-lookup"><span data-stu-id="a6801-140">Blazor WebAssembly (`_Imports.razor`):</span></span>
   
   ```razor
   @using System.Net.Http
   @using System.Net.Http.Json
   @using Microsoft.AspNetCore.Components.Forms
   @using Microsoft.AspNetCore.Components.Routing
   @using Microsoft.AspNetCore.Components.Web
   @using Microsoft.AspNetCore.Components.Web.Virtualization
   @using Microsoft.AspNetCore.Components.WebAssembly.Http
   @using Microsoft.JSInterop
   @using {ASSEMBLY NAME}
   @using {ASSEMBLY NAME}.Shared
   ```

   <span data-ttu-id="a6801-141">Blazor Server (`_Imports.razor`):</span><span class="sxs-lookup"><span data-stu-id="a6801-141">Blazor Server (`_Imports.razor`):</span></span>
   
   ```razor
   @using System.Net.Http
   @using Microsoft.AspNetCore.Authorization
   @using Microsoft.AspNetCore.Components.Authorization
   @using Microsoft.AspNetCore.Components.Forms
   @using Microsoft.AspNetCore.Components.Routing
   @using Microsoft.AspNetCore.Components.Web
   @using Microsoft.AspNetCore.Components.Web.Virtualization
   @using Microsoft.JSInterop
   @using {ASSEMBLY NAME}
   @using {ASSEMBLY NAME}.Shared
   ```
   
1. <span data-ttu-id="a6801-142">W `MainLayout` składniku ( `Shared/MainLayout.razor` ) OTOCZ znaczniki HTML składnika z `<div>` elementem, który ma `class` atrybut ustawiony na `page` :</span><span class="sxs-lookup"><span data-stu-id="a6801-142">In the `MainLayout` component (`Shared/MainLayout.razor`), surround the component's HTML markup with a `<div>` element that has a `class` attribute set to `page`:</span></span>

    ```razor
    <div class="page">
    
        ...
        
    </div>
    ```
    
1. <span data-ttu-id="a6801-143">Dodaj następujące pliki do `Shared` folderu:</span><span class="sxs-lookup"><span data-stu-id="a6801-143">Add the following files to the `Shared` folder:</span></span>

    <span data-ttu-id="a6801-144">`MainLayout.razor.css`:</span><span class="sxs-lookup"><span data-stu-id="a6801-144">`MainLayout.razor.css`:</span></span>
    
    ```css
    .page {
        position: relative;
        display: flex;
        flex-direction: column;
    }

    .main {
        flex: 1;
    }

    .sidebar {
        background-image: linear-gradient(180deg, rgb(5, 39, 103) 0%, #3a0647 70%);
    }

    .top-row {
        background-color: #f7f7f7;
        border-bottom: 1px solid #d6d5d5;
        justify-content: flex-end;
        height: 3.5rem;
        display: flex;
        align-items: center;
    }

        .top-row ::deep a, .top-row .btn-link {
            white-space: nowrap;
            margin-left: 1.5rem;
        }

        .top-row a:first-child {
            overflow: hidden;
            text-overflow: ellipsis;
        }

    @media (max-width: 767.98px) {
        .top-row:not(.auth) {
            display: none;
        }

        .top-row.auth {
            justify-content: space-between;
        }

        .top-row a, .top-row .btn-link {
            margin-left: 0;
        }
    }

    @media (min-width: 768px) {
        .page {
            flex-direction: row;
        }

        .sidebar {
            width: 250px;
            height: 100vh;
            position: sticky;
            top: 0;
        }

        .top-row {
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .main > div {
            padding-left: 2rem !important;
            padding-right: 1.5rem !important;
        }
    }
    ```
    
    <span data-ttu-id="a6801-145">`NavMenu.razor.css`:</span><span class="sxs-lookup"><span data-stu-id="a6801-145">`NavMenu.razor.css`:</span></span>
    
    ```css
    .navbar-toggler {
        background-color: rgba(255, 255, 255, 0.1);
    }

    .top-row {
        height: 3.5rem;
        background-color: rgba(0,0,0,0.4);
    }

    .navbar-brand {
        font-size: 1.1rem;
    }

    .oi {
        width: 2rem;
        font-size: 1.1rem;
        vertical-align: text-top;
        top: -2px;
    }

    .nav-item {
        font-size: 0.9rem;
        padding-bottom: 0.5rem;
    }

        .nav-item:first-of-type {
            padding-top: 1rem;
        }

        .nav-item:last-of-type {
            padding-bottom: 1rem;
        }

        .nav-item ::deep a {
            color: #d7d7d7;
            border-radius: 4px;
            height: 3rem;
            display: flex;
            align-items: center;
            line-height: 3rem;
        }

    .nav-item ::deep a.active {
        background-color: rgba(255,255,255,0.25);
        color: white;
    }

    .nav-item ::deep a:hover {
        background-color: rgba(255,255,255,0.1);
        color: white;
    }

    @media (min-width: 768px) {
        .navbar-toggler {
            display: none;
        }

        .collapse {
            /* Never collapse the sidebar for wide screens */
            display: block;
        }
    }
    ```

1. <span data-ttu-id="a6801-146">Najnowszy plik podstawowy `wwwroot/css/app.css` Blazor WebAssembly aplikacji lub `wwwroot/css/site.css` pliku Blazor Server aplikacji zawiera następujące style.</span><span class="sxs-lookup"><span data-stu-id="a6801-146">The latest base `wwwroot/css/app.css` file of a Blazor WebAssembly app or `wwwroot/css/site.css` file of a Blazor Server app includes the following styles.</span></span> <span data-ttu-id="a6801-147">Usuń dodatkowe style, pozostawiając następujące style i dodanych do aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a6801-147">Remove extra styles leaving the following styles and any that you've added to the app.</span></span>

    <span data-ttu-id="a6801-148">Następujący arkusz stylów zawiera tylko style podstawowe i nie **zawiera niestandardowych** stylów dodanych przez dewelopera:</span><span class="sxs-lookup"><span data-stu-id="a6801-148">The following stylesheet only includes base styles and does **not** include custom styles added by the developer:</span></span>
   
    ```css
    @import url('open-iconic/font/css/open-iconic-bootstrap.min.css');

    html, body {
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    }

    a, .btn-link {
        color: #0366d6;
    }

    .btn-primary {
        color: #fff;
        background-color: #1b6ec2;
        border-color: #1861ac;
    }

    .content {
        padding-top: 1.1rem;
    }

    .valid.modified:not([type=checkbox]) {
        outline: 1px solid #26b050;
    }

    .invalid {
        outline: 1px solid red;
    }

    .validation-message {
        color: red;
    }

    #blazor-error-ui {
        background: lightyellow;
        bottom: 0;
        box-shadow: 0 -1px 2px rgba(0, 0, 0, 0.2);
        display: none;
        left: 0;
        padding: 0.6rem 1.25rem 0.7rem 1.25rem;
        position: fixed;
        width: 100%;
        z-index: 1000;
    }

    #blazor-error-ui .dismiss {
        cursor: pointer;
        position: absolute;
        right: 0.75rem;
        top: 0.5rem;
    }
    ```

## <a name="update-blazor-webassembly-projects"></a><span data-ttu-id="a6801-149">Aktualizowanie Blazor WebAssembly projektów</span><span class="sxs-lookup"><span data-stu-id="a6801-149">Update Blazor WebAssembly projects</span></span>

<span data-ttu-id="a6801-150">Postępuj zgodnie ze wskazówkami w sekcji Poprzednia [Aktualizacja Blazor WebAssembly i Blazor Server projekty](#update-blazor-webassembly-and-blazor-server-projects) .</span><span class="sxs-lookup"><span data-stu-id="a6801-150">Follow the guidance in the preceding [Update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) section.</span></span>

<span data-ttu-id="a6801-151">W przypadku Blazor WebAssembly projektu, w tym *`Client`* projektu rozwiązania hostowanego Blazor , zastosuj następujące zmiany do pliku projektu:</span><span class="sxs-lookup"><span data-stu-id="a6801-151">For a Blazor WebAssembly project, including the *`Client`* project of a hosted Blazor solution, apply the following changes to the project file:</span></span>

1. <span data-ttu-id="a6801-152">Zaktualizuj zestaw SDK z `Microsoft.NET.Sdk.Web` programu do `Microsoft.NET.Sdk.BlazorWebAssembly` :</span><span class="sxs-lookup"><span data-stu-id="a6801-152">Update the SDK from `Microsoft.NET.Sdk.Web` to `Microsoft.NET.Sdk.BlazorWebAssembly`:</span></span>

    ```diff
    - <Project Sdk="Microsoft.NET.Sdk.Web">
    + <Project Sdk="Microsoft.NET.Sdk.BlazorWebAssembly">
    ```
    
    > [!NOTE]
    > <span data-ttu-id="a6801-153">Ta aktualizacja dotyczy tylko projektów autonomicznych Blazor WebAssembly i *`Client`* projektów hostowanych Blazor rozwiązań.</span><span class="sxs-lookup"><span data-stu-id="a6801-153">This update only applies to standalone Blazor WebAssembly projects and the *`Client`* projects of hosted Blazor solutions.</span></span>

1. <span data-ttu-id="a6801-154">Zaktualizuj następujące właściwości:</span><span class="sxs-lookup"><span data-stu-id="a6801-154">Update the following properties:</span></span>

    ```diff
    <Project Sdk="Microsoft.NET.Sdk.BlazorWebAssembly">
    
      <PropertyGroup>
    -     <TargetFramework>netstandard2.1</TargetFramework>
    -     <RazorLangVersion>3.0</RazorLangVersion>
    +     <TargetFramework>net5.0</TargetFramework>
      </PropertyGroup>
    ```

1. <span data-ttu-id="a6801-155">Usuń odwołanie do pakietu do [Microsoft. AspNetCore. Components. webassembly. Build](https://www.nuget.org/packages/Microsoft.AspNetCore.Components.WebAssembly.Build):</span><span class="sxs-lookup"><span data-stu-id="a6801-155">Remove the package reference to [Microsoft.AspNetCore.Components.WebAssembly.Build](https://www.nuget.org/packages/Microsoft.AspNetCore.Components.WebAssembly.Build):</span></span>

    ```diff
    <ItemGroup>
    -    <PackageReference Include="Microsoft.AspNetCore.Components.WebAssembly.Build" Version="3.2.1" PrivateAssets="all" />
    ```

1. <span data-ttu-id="a6801-156">Zaktualizuj inne pakiety do ich najnowszych wersji.</span><span class="sxs-lookup"><span data-stu-id="a6801-156">Update other packages to their latest versions.</span></span> <span data-ttu-id="a6801-157">Najnowsze wersje można znaleźć pod adresem [NuGet.org](https://www.nuget.org).</span><span class="sxs-lookup"><span data-stu-id="a6801-157">The latest versions can be found at [NuGet.org](https://www.nuget.org).</span></span>

1. <span data-ttu-id="a6801-158">W programie `wwwroot/index.html` Zmień element, który ładuje `App` składnik do `<div>` elementu z `id` zestawem `app` :</span><span class="sxs-lookup"><span data-stu-id="a6801-158">In `wwwroot/index.html`, change the element that loads the `App` component to a `<div>` element with an `id` set to `app`:</span></span>
    
    ```diff
    -<app>Loading...</app>
    +<div id="app">Loading...</div>
    ```

1. <span data-ttu-id="a6801-159">W `Program.Main` ( `Program.cs` ) Zmień odwołanie do `<app>` elementu na Selektor CSS, dodając `#` do niego skrót:</span><span class="sxs-lookup"><span data-stu-id="a6801-159">In `Program.Main` (`Program.cs`), change the reference to the `<app>` element to a CSS selector by adding a hash `#` to it:</span></span>

    ```diff
    -builder.RootComponents.Add<App>("app");
    +builder.RootComponents.Add<App>("#app");
    ```

1. <span data-ttu-id="a6801-160">W programie `Program.Main` ( `Program.cs` ) Zmień domyślną `HttpClient` rejestrację przejściową na zakres, jeśli jest obecny:</span><span class="sxs-lookup"><span data-stu-id="a6801-160">In `Program.Main` (`Program.cs`), change a default transient `HttpClient` registration to scoped, if present:</span></span>

   ```diff
   -builder.Services.AddTransient(sp => new HttpClient 
   -    { BaseAddress = new Uri(builder.HostEnvironment.BaseAddress) });
   +builder.Services.AddScoped(sp => new HttpClient 
   +    { BaseAddress = new Uri(builder.HostEnvironment.BaseAddress) });
   ```

1. <span data-ttu-id="a6801-161">W `Program.Main` ( `Program.cs` ) **`Client`** aplikacji hostowanych Blazor rozwiązań:</span><span class="sxs-lookup"><span data-stu-id="a6801-161">In `Program.Main` (`Program.cs`) of the **`Client`** app of hosted Blazor solutions:</span></span>
    
   * <span data-ttu-id="a6801-162">Opcjonalnie należy zastąpić `builder.HostEnvironment.BaseAddress` ciąg adresami podstawowymi klientów.</span><span class="sxs-lookup"><span data-stu-id="a6801-162">Optionally, substitute `builder.HostEnvironment.BaseAddress` for string client base addresses.</span></span>
   * <span data-ttu-id="a6801-163">Zmień wszystkie nazwane rejestracje fabryczne klienta na zakres.</span><span class="sxs-lookup"><span data-stu-id="a6801-163">Change any named transient client factory registrations to scoped.</span></span>

   ```diff
   -builder.Services.AddHttpClient("{APP NAMESPACE}.ServerAPI", 
   -    client => client.BaseAddress = new Uri("https://localhost:5001"))
   -    .AddHttpMessageHandler<BaseAddressAuthorizationMessageHandler>();
   -builder.Services.AddTransient(sp => sp.GetRequiredService<IHttpClientFactory>()
   -    .CreateClient("{APP NAMESPACE}.ServerAPI"));
   +builder.Services.AddHttpClient("{APP NAMESPACE}.ServerAPI", 
   +    client => client.BaseAddress = new Uri(builder.HostEnvironment.BaseAddress))
   +    .AddHttpMessageHandler<BaseAddressAuthorizationMessageHandler>();
   +builder.Services.AddScoped(sp => sp.GetRequiredService<IHttpClientFactory>()
   +    .CreateClient("{APP NAMESPACE}.ServerAPI"));
    ```
    
   <span data-ttu-id="a6801-164">W poprzednim kodzie `{APP NAMESPACE}` symbol zastępczy jest przestrzenią nazw aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a6801-164">In the preceding code, the `{APP NAMESPACE}` placeholder is the app's namespace.</span></span>

### <a name="standalone-blazor-webassembly-app-with-microsoft-accounts"></a><span data-ttu-id="a6801-165">Aplikacja autonomiczna Blazor WebAssembly z kontami Microsoft</span><span class="sxs-lookup"><span data-stu-id="a6801-165">Standalone Blazor WebAssembly app with Microsoft Accounts</span></span>

<span data-ttu-id="a6801-166">Postępuj zgodnie ze wskazówkami w sekcji poprzednie [aktualizacje Blazor WebAssembly i Blazor Server projekty](#update-blazor-webassembly-and-blazor-server-projects) i [Aktualizuj Blazor WebAssembly projekty](#update-blazor-webassembly-projects) .</span><span class="sxs-lookup"><span data-stu-id="a6801-166">Follow the guidance in the preceding [Update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) and [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) sections.</span></span>

<span data-ttu-id="a6801-167">W przypadku aplikacji autonomicznej Blazor WebAssembly zarejestrowanej w Azure Portal korzystania z usługi Azure Active Directory (AAD) dla kont Microsoft:</span><span class="sxs-lookup"><span data-stu-id="a6801-167">For a standalone Blazor WebAssembly app registered in the Azure portal to use Azure Active Directory (AAD) for Microsoft Accounts:</span></span>

* <span data-ttu-id="a6801-168">Aplikacja wymaga `openid` `offline_access` zakresów i:</span><span class="sxs-lookup"><span data-stu-id="a6801-168">The app requires the `openid` and `offline_access` scopes:</span></span>

  ```csharp
  options.ProviderOptions.DefaultAccessTokenScopes.Add("openid");
  options.ProviderOptions.DefaultAccessTokenScopes.Add("offline_access");
  ```
  
* <span data-ttu-id="a6801-169">W bloku **uwierzytelnianie** aplikacji Azure Portal:</span><span class="sxs-lookup"><span data-stu-id="a6801-169">In the Azure portal app registration **Authentication** blade:</span></span>

  1. <span data-ttu-id="a6801-170">Usuń konfigurację platformy **sieci Web** .</span><span class="sxs-lookup"><span data-stu-id="a6801-170">Remove the **Web** platform configuration.</span></span>
  1. <span data-ttu-id="a6801-171">Dodaj **jednostronicową** konfigurację platformy aplikacji z identyfikatorem URI przekierowania aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a6801-171">Add a **Single-page application** platform configuration with the app's redirect URI.</span></span>
  1. <span data-ttu-id="a6801-172">Wyłącz **niejawne przyznanie** tokenów **dostępu** i **tokenów identyfikatorów**.</span><span class="sxs-lookup"><span data-stu-id="a6801-172">Disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>

<span data-ttu-id="a6801-173">Aby uzyskać więcej informacji, zobacz <xref:blazor/security/webassembly/standalone-with-microsoft-accounts>.</span><span class="sxs-lookup"><span data-stu-id="a6801-173">For more information, see <xref:blazor/security/webassembly/standalone-with-microsoft-accounts>.</span></span>

### <a name="standalone-blazor-webassembly-app-with-azure-active-directory-aad"></a><span data-ttu-id="a6801-174">Aplikacja autonomiczna Blazor WebAssembly z Azure Active Directory (AAD)</span><span class="sxs-lookup"><span data-stu-id="a6801-174">Standalone Blazor WebAssembly app with Azure Active Directory (AAD)</span></span>

<span data-ttu-id="a6801-175">Postępuj zgodnie ze wskazówkami w sekcji poprzednie [aktualizacje Blazor WebAssembly i Blazor Server projekty](#update-blazor-webassembly-and-blazor-server-projects) i [Aktualizuj Blazor WebAssembly projekty](#update-blazor-webassembly-projects) .</span><span class="sxs-lookup"><span data-stu-id="a6801-175">Follow the guidance in the preceding [Update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) and [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) sections.</span></span>

<span data-ttu-id="a6801-176">W przypadku aplikacji autonomicznej Blazor WebAssembly zarejestrowanej w Azure Portal używać Azure Active Directory (AAD):</span><span class="sxs-lookup"><span data-stu-id="a6801-176">For a standalone Blazor WebAssembly app registered in the Azure portal to use Azure Active Directory (AAD):</span></span>

* <span data-ttu-id="a6801-177">Aplikacja wymaga `https://graph.microsoft.com/User.Read` zakresu:</span><span class="sxs-lookup"><span data-stu-id="a6801-177">The app requires the `https://graph.microsoft.com/User.Read` scope:</span></span>

  ```csharp
  options.ProviderOptions.DefaultAccessTokenScopes
      .Add("https://graph.microsoft.com/User.Read");
  ```
  
* <span data-ttu-id="a6801-178">W bloku **uwierzytelnianie** aplikacji Azure Portal:</span><span class="sxs-lookup"><span data-stu-id="a6801-178">In the Azure portal app registration **Authentication** blade:</span></span>

  1. <span data-ttu-id="a6801-179">Usuń konfigurację platformy **sieci Web** .</span><span class="sxs-lookup"><span data-stu-id="a6801-179">Remove the **Web** platform configuration.</span></span>
  1. <span data-ttu-id="a6801-180">Dodaj **jednostronicową** konfigurację platformy aplikacji z identyfikatorem URI przekierowania aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a6801-180">Add a **Single-page application** platform configuration with the app's redirect URI.</span></span>
  1. <span data-ttu-id="a6801-181">Wyłącz **niejawne przyznanie** tokenów **dostępu** i **tokenów identyfikatorów**.</span><span class="sxs-lookup"><span data-stu-id="a6801-181">Disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>
  
<span data-ttu-id="a6801-182">Aby uzyskać więcej informacji, zobacz <xref:blazor/security/webassembly/standalone-with-azure-active-directory>.</span><span class="sxs-lookup"><span data-stu-id="a6801-182">For more information, see <xref:blazor/security/webassembly/standalone-with-azure-active-directory>.</span></span>

### <a name="standalone-blazor-webassembly-app-with-azure-active-directory-aad-b2c"></a><span data-ttu-id="a6801-183">Aplikacja autonomiczna Blazor WebAssembly z usługą Azure Active Directory (AAD) B2C</span><span class="sxs-lookup"><span data-stu-id="a6801-183">Standalone Blazor WebAssembly app with Azure Active Directory (AAD) B2C</span></span>

<span data-ttu-id="a6801-184">Postępuj zgodnie ze wskazówkami w sekcji poprzednie [aktualizacje Blazor WebAssembly i Blazor Server projekty](#update-blazor-webassembly-and-blazor-server-projects) i [Aktualizuj Blazor WebAssembly projekty](#update-blazor-webassembly-projects) .</span><span class="sxs-lookup"><span data-stu-id="a6801-184">Follow the guidance in the preceding [Update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) and [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) sections.</span></span>

<span data-ttu-id="a6801-185">W przypadku aplikacji autonomicznej Blazor WebAssembly zarejestrowanej w Azure Portal używać Azure Active Directory (AAD) B2C:</span><span class="sxs-lookup"><span data-stu-id="a6801-185">For a standalone Blazor WebAssembly app registered in the Azure portal to use Azure Active Directory (AAD) B2C:</span></span>

* <span data-ttu-id="a6801-186">Aplikacja wymaga `openid` `offline_access` zakresów i:</span><span class="sxs-lookup"><span data-stu-id="a6801-186">The app requires the `openid` and `offline_access` scopes:</span></span>

  ```csharp
  options.ProviderOptions.DefaultAccessTokenScopes.Add("openid");
  options.ProviderOptions.DefaultAccessTokenScopes.Add("offline_access");
  ```
  
* <span data-ttu-id="a6801-187">W bloku **uwierzytelnianie** aplikacji Azure Portal:</span><span class="sxs-lookup"><span data-stu-id="a6801-187">In the Azure portal app registration **Authentication** blade:</span></span>

  1. <span data-ttu-id="a6801-188">Usuń konfigurację platformy **sieci Web** .</span><span class="sxs-lookup"><span data-stu-id="a6801-188">Remove the **Web** platform configuration.</span></span>
  1. <span data-ttu-id="a6801-189">Dodaj **jednostronicową** konfigurację platformy aplikacji z identyfikatorem URI przekierowania aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a6801-189">Add a **Single-page application** platform configuration with the app's redirect URI.</span></span>
  1. <span data-ttu-id="a6801-190">Wyłącz **niejawne przyznanie** tokenów **dostępu** i **tokenów identyfikatorów**.</span><span class="sxs-lookup"><span data-stu-id="a6801-190">Disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>

<span data-ttu-id="a6801-191">Aby uzyskać więcej informacji, zobacz <xref:blazor/security/webassembly/standalone-with-azure-active-directory-b2c>.</span><span class="sxs-lookup"><span data-stu-id="a6801-191">For more information, see <xref:blazor/security/webassembly/standalone-with-azure-active-directory-b2c>.</span></span>

### <a name="hosted-blazor-webassembly-app-with-azure-active-directory-aad-or-aad-b2c"></a><span data-ttu-id="a6801-192">Hostowana Blazor WebAssembly aplikacja z Azure Active Directory (AAD) lub AAD B2C</span><span class="sxs-lookup"><span data-stu-id="a6801-192">Hosted Blazor WebAssembly app with Azure Active Directory (AAD) or AAD B2C</span></span>

<span data-ttu-id="a6801-193">Postępuj zgodnie ze wskazówkami w sekcji poprzednie [aktualizacje Blazor WebAssembly i Blazor Server projekty](#update-blazor-webassembly-and-blazor-server-projects) i [Aktualizuj Blazor WebAssembly projekty](#update-blazor-webassembly-projects) .</span><span class="sxs-lookup"><span data-stu-id="a6801-193">Follow the guidance in the preceding [Update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) and [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) sections.</span></span>

<span data-ttu-id="a6801-194">*`Client`* Rejestracja aplikacji hostowanego Blazor rozwiązania korzystającego z usługi AAD lub AAD B2C do uwierzytelniania użytkowników powinna być oparta na **jednostronicowej** konfiguracji platformy aplikacji platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="a6801-194">The *`Client`* app registration of a hosted Blazor solution that uses AAD or AAD B2C for user authentication should use a **Single-page application** Azure Apps platform configuration.</span></span>

<span data-ttu-id="a6801-195">W *`Client`* bloku **uwierzytelnianie** aplikacji Azure Portal:</span><span class="sxs-lookup"><span data-stu-id="a6801-195">In the Azure portal *`Client`* app registration **Authentication** blade:</span></span>

  1. <span data-ttu-id="a6801-196">Usuń konfigurację platformy **sieci Web** .</span><span class="sxs-lookup"><span data-stu-id="a6801-196">Remove the **Web** platform configuration.</span></span>
  1. <span data-ttu-id="a6801-197">Dodaj **jednostronicową** konfigurację platformy aplikacji z identyfikatorem URI przekierowania aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a6801-197">Add a **Single-page application** platform configuration with the app's redirect URI.</span></span>
  1. <span data-ttu-id="a6801-198">Wyłącz **niejawne przyznanie** tokenów **dostępu** i **tokenów identyfikatorów**.</span><span class="sxs-lookup"><span data-stu-id="a6801-198">Disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>

<span data-ttu-id="a6801-199">Aby uzyskać więcej informacji, zobacz:</span><span class="sxs-lookup"><span data-stu-id="a6801-199">For more information, see:</span></span>

* <xref:blazor/security/webassembly/hosted-with-azure-active-directory>
* <xref:blazor/security/webassembly/hosted-with-azure-active-directory-b2c>

### <a name="update-the-server-project-of-a-hosted-blazor-solution"></a><span data-ttu-id="a6801-200">Aktualizowanie projektu serwera hostowanego Blazor rozwiązania</span><span class="sxs-lookup"><span data-stu-id="a6801-200">Update the Server project of a hosted Blazor solution</span></span>

<span data-ttu-id="a6801-201">Postępuj zgodnie ze wskazówkami w powyższych sekcjach:</span><span class="sxs-lookup"><span data-stu-id="a6801-201">Follow the guidance in the preceding sections:</span></span>

* [<span data-ttu-id="a6801-202">Aktualizacja Blazor WebAssembly i Blazor Server projekty</span><span class="sxs-lookup"><span data-stu-id="a6801-202">Update Blazor WebAssembly and Blazor Server projects</span></span>](#update-blazor-webassembly-and-blazor-server-projects)
* [<span data-ttu-id="a6801-203">Aktualizowanie Blazor WebAssembly projektów</span><span class="sxs-lookup"><span data-stu-id="a6801-203">Update Blazor WebAssembly projects</span></span>](#update-blazor-webassembly-projects)
* <span data-ttu-id="a6801-204">Sekcja, która ma zastosowanie do dostawcy aplikacji z Azure Active Directory:</span><span class="sxs-lookup"><span data-stu-id="a6801-204">The section that applies to the app's provider with Azure Active Directory:</span></span>
  * [<span data-ttu-id="a6801-205">Aplikacja autonomiczna Blazor WebAssembly z kontami Microsoft</span><span class="sxs-lookup"><span data-stu-id="a6801-205">Standalone Blazor WebAssembly app with Microsoft Accounts</span></span>](#standalone-blazor-webassembly-app-with-microsoft-accounts)
  * [<span data-ttu-id="a6801-206">Aplikacja autonomiczna Blazor WebAssembly z Azure Active Directory (AAD)</span><span class="sxs-lookup"><span data-stu-id="a6801-206">Standalone Blazor WebAssembly app with Azure Active Directory (AAD)</span></span>](#standalone-blazor-webassembly-app-with-azure-active-directory-aad)
  * [<span data-ttu-id="a6801-207">Aplikacja autonomiczna Blazor WebAssembly z usługą Azure Active Directory (AAD) B2C</span><span class="sxs-lookup"><span data-stu-id="a6801-207">Standalone Blazor WebAssembly app with Azure Active Directory (AAD) B2C</span></span>](#standalone-blazor-webassembly-app-with-azure-active-directory-aad-b2c)

<span data-ttu-id="a6801-208">Zaktualizuj *`Server`* projekt rozwiązania hostowanego Blazor jako aplikację ASP.NET Coreową, postępując zgodnie z ogólnymi wskazówkami w tym artykule.</span><span class="sxs-lookup"><span data-stu-id="a6801-208">Update the *`Server`* project of a hosted Blazor solution as an ASP.NET Core app following the general guidance in this article.</span></span>

<span data-ttu-id="a6801-209">Ponadto *`Server`* projekty uwierzytelniające użytkowników w aplikacjach klienckich Blazor WebAssembly za pomocą usługi Azure Active Directory (AAD) lub B2C powinny przyjmować nowe Identity pakiety Microsoft v 2.0:</span><span class="sxs-lookup"><span data-stu-id="a6801-209">Additionally, *`Server`* projects that authenticate users to client Blazor WebAssembly apps with Azure Active Directory (AAD) or B2C should adopt new Microsoft Identity v2.0 packages:</span></span> 
  
<span data-ttu-id="a6801-210">W przypadku usługi AAD:</span><span class="sxs-lookup"><span data-stu-id="a6801-210">For AAD:</span></span>

```diff
-<PackageReference Include="Microsoft.AspNetCore.Authentication.AzureAD.UI" Version="..." />
+<PackageReference Include="Microsoft.Identity.Web" Version="{VERSION}" />
+<PackageReference Include="Microsoft.Identity.Web.UI" Version="{VERSION}" />
```

<span data-ttu-id="a6801-211">Dla AAD B2C:</span><span class="sxs-lookup"><span data-stu-id="a6801-211">For AAD B2C:</span></span>

```diff
-<PackageReference Include="Microsoft.AspNetCore.Authentication.AzureADB2C.UI" Version="..." />
+<PackageReference Include="Microsoft.Identity.Web" Version="{VERSION}" />
+<PackageReference Include="Microsoft.Identity.Web.UI" Version="{VERSION}" />
```

<span data-ttu-id="a6801-212">W przypadku poprzedzających odwołań do pakietu Ustal wersje pakietu dla `{VERSION}` symboli zastępczych w NuGet.org:</span><span class="sxs-lookup"><span data-stu-id="a6801-212">For the preceding package references, determine the package versions for the `{VERSION}` placeholders at NuGet.org:</span></span>

* [`Microsoft.Identity.Web`](https://www.nuget.org/packages/Microsoft.Identity.Web)
* [`Microsoft.Identity.Web.UI`](https://www.nuget.org/packages/Microsoft.Identity.Web.UI)

> [!NOTE]
> <span data-ttu-id="a6801-213">Zestaw SDK *`Server`* projektu w hostowanym Blazor WebAssembly rozwiązaniu pozostaje `Microsoft.NET.Sdk.Web` :</span><span class="sxs-lookup"><span data-stu-id="a6801-213">The SDK of the *`Server`* project in a hosted Blazor WebAssembly solution remains `Microsoft.NET.Sdk.Web`:</span></span>
>
> ```xml
> <Project Sdk="Microsoft.NET.Sdk.Web">
> ```

<span data-ttu-id="a6801-214">Aby uzyskać więcej informacji, zobacz:</span><span class="sxs-lookup"><span data-stu-id="a6801-214">For more information, see:</span></span>

* <xref:blazor/security/webassembly/hosted-with-azure-active-directory>
* <xref:blazor/security/webassembly/hosted-with-azure-active-directory-b2c>

### <a name="clean-and-rebuild-the-solution"></a><span data-ttu-id="a6801-215">Czyszczenie i ponowne kompilowanie rozwiązania</span><span class="sxs-lookup"><span data-stu-id="a6801-215">Clean and rebuild the solution</span></span>

<span data-ttu-id="a6801-216">Po przeprowadzeniu migracji aplikacji lub rozwiązania do programu .NET 5 Wyczyść i ponownie skompiluj aplikację lub rozwiązanie.</span><span class="sxs-lookup"><span data-stu-id="a6801-216">After migrating the app or solution to .NET 5, clean and rebuild the app or solution.</span></span> <span data-ttu-id="a6801-217">Jeśli istnieją niezgodności pakietów między nowym odwołaniem do pakietu i buforowanymi pakietami:</span><span class="sxs-lookup"><span data-stu-id="a6801-217">If package incompatibilities exist between new package references and cached packages:</span></span>

1. <span data-ttu-id="a6801-218">Wyczyść pamięć podręczną pakietów NuGet, wykonując następujące [`dotnet nuget locals`](/dotnet/core/tools/dotnet-nuget-locals) polecenie w powłoce poleceń:</span><span class="sxs-lookup"><span data-stu-id="a6801-218">Clear NuGet package caches by executing the following [`dotnet nuget locals`](/dotnet/core/tools/dotnet-nuget-locals) command in a command shell:</span></span>

   ```dotnetcli
   dotnet nuget locals --clear all
   ```
   
1. <span data-ttu-id="a6801-219">Oczyść i ponownie skompiluj aplikację lub rozwiązanie.</span><span class="sxs-lookup"><span data-stu-id="a6801-219">Clean and rebuild the app or solution.</span></span>

### <a name="troubleshoot"></a><span data-ttu-id="a6801-220">Rozwiązywanie problemów</span><span class="sxs-lookup"><span data-stu-id="a6801-220">Troubleshoot</span></span>

<span data-ttu-id="a6801-221">Postępuj zgodnie ze wskazówkami dotyczącymi *rozwiązywania problemów* na końcu Blazor WebAssembly tematu zabezpieczeń, który ma zastosowanie do Twojej aplikacji:</span><span class="sxs-lookup"><span data-stu-id="a6801-221">Follow the *Troubleshoot* guidance at the end of the Blazor WebAssembly security topic that applies to your app:</span></span>

<span data-ttu-id="a6801-222">Aplikacje autonomiczne Blazor WebAssembly :</span><span class="sxs-lookup"><span data-stu-id="a6801-222">Standalone Blazor WebAssembly apps:</span></span>

* [<span data-ttu-id="a6801-223">Ogólne wskazówki dla dostawców OIDC i biblioteki uwierzytelniania webassembly</span><span class="sxs-lookup"><span data-stu-id="a6801-223">General guidance for OIDC providers and the WebAssembly Authentication Library</span></span>](xref:blazor/security/webassembly/standalone-with-authentication-library)
* [<span data-ttu-id="a6801-224">Konta Microsoft</span><span class="sxs-lookup"><span data-stu-id="a6801-224">Microsoft Accounts</span></span>](xref:blazor/security/webassembly/standalone-with-microsoft-accounts)
* [<span data-ttu-id="a6801-225">Usługa Azure Active Directory (AAD)</span><span class="sxs-lookup"><span data-stu-id="a6801-225">Azure Active Directory (AAD)</span></span>](xref:blazor/security/webassembly/standalone-with-azure-active-directory)
* [<span data-ttu-id="a6801-226">Azure Active Directory (AAD) B2C</span><span class="sxs-lookup"><span data-stu-id="a6801-226">Azure Active Directory (AAD) B2C</span></span>](xref:blazor/security/webassembly/standalone-with-azure-active-directory-b2c)

<span data-ttu-id="a6801-227">Hostowane Blazor WebAssembly aplikacje:</span><span class="sxs-lookup"><span data-stu-id="a6801-227">Hosted Blazor WebAssembly apps:</span></span>

* [<span data-ttu-id="a6801-228">Usługa Azure Active Directory (AAD)</span><span class="sxs-lookup"><span data-stu-id="a6801-228">Azure Active Directory (AAD)</span></span>](xref:blazor/security/webassembly/hosted-with-azure-active-directory)
* [<span data-ttu-id="a6801-229">Azure Active Directory (AAD) B2C</span><span class="sxs-lookup"><span data-stu-id="a6801-229">Azure Active Directory (AAD) B2C</span></span>](xref:blazor/security/webassembly/hosted-with-azure-active-directory-b2c)
* [<span data-ttu-id="a6801-230">Identity Server</span><span class="sxs-lookup"><span data-stu-id="a6801-230">Identity Server</span></span>](xref:blazor/security/webassembly/hosted-with-identity-server)

### <a name="unauthorized-client-for-azure-active-directory-aad"></a><span data-ttu-id="a6801-231">Nieautoryzowany klient dla Azure Active Directory (AAD)</span><span class="sxs-lookup"><span data-stu-id="a6801-231">Unauthorized client for Azure Active Directory (AAD)</span></span>

<span data-ttu-id="a6801-232">Po uaktualnieniu aplikacji korzystającej z usługi Blazor WebAssembly AAD do uwierzytelniania może zostać wyświetlony następujący błąd w wywołaniu zwrotnym logowania do aplikacji po zalogowaniu się użytkownika w usłudze AAD:</span><span class="sxs-lookup"><span data-stu-id="a6801-232">After upgrading a Blazor WebAssembly app that uses AAD for authentication, you may receive the following error on the login callback to the app after the user signs in with AAD:</span></span>

> <span data-ttu-id="a6801-233">Informacja: uwierzytelnianie Microsoft. AspNetCore. Authorization. DefaultAuthorizationService [2] nie powiodło się.</span><span class="sxs-lookup"><span data-stu-id="a6801-233">info: Microsoft.AspNetCore.Authorization.DefaultAuthorizationService[2] Authorization failed.</span></span> <span data-ttu-id="a6801-234">Te wymagania nie zostały spełnione: DenyAnonymousAuthorizationRequirement: wymaga uwierzytelnionego użytkownika.</span><span class="sxs-lookup"><span data-stu-id="a6801-234">These requirements were not met: DenyAnonymousAuthorizationRequirement: Requires an authenticated user.</span></span>

<span data-ttu-id="a6801-235">Błąd wywołania zwrotnego logowania z usługi AAD:</span><span class="sxs-lookup"><span data-stu-id="a6801-235">Login callback error from AAD:</span></span>

* <span data-ttu-id="a6801-236">Błąd: `unauthorized_client`</span><span class="sxs-lookup"><span data-stu-id="a6801-236">Error: `unauthorized_client`</span></span>
* <span data-ttu-id="a6801-237">Zharmonizowan `AADB2C90058: The provided application is not configured to allow public clients.`</span><span class="sxs-lookup"><span data-stu-id="a6801-237">Description: `AADB2C90058: The provided application is not configured to allow public clients.`</span></span>

<span data-ttu-id="a6801-238">Aby rozwiązać ten problem:</span><span class="sxs-lookup"><span data-stu-id="a6801-238">To resolve the error:</span></span>

1. <span data-ttu-id="a6801-239">W Azure Portal uzyskaj dostęp do [manifestu aplikacji](/azure/active-directory/develop/reference-app-manifest).</span><span class="sxs-lookup"><span data-stu-id="a6801-239">In the Azure portal, access the [app's manifest](/azure/active-directory/develop/reference-app-manifest).</span></span>
1. <span data-ttu-id="a6801-240">Ustaw [`allowPublicClient`](/azure/active-directory/develop/reference-app-manifest#allowpublicclient-attribute) atrybut na `null` lub `true` .</span><span class="sxs-lookup"><span data-stu-id="a6801-240">Set the [`allowPublicClient`](/azure/active-directory/develop/reference-app-manifest#allowpublicclient-attribute) attribute to `null` or `true`.</span></span>

## <a name="update-a-blazor-progressive-web-application-pwa"></a><span data-ttu-id="a6801-241">Aktualizowanie Blazor progresywnej aplikacji sieci Web (PWA)</span><span class="sxs-lookup"><span data-stu-id="a6801-241">Update a Blazor Progressive Web Application (PWA)</span></span>

<span data-ttu-id="a6801-242">Dodaj następujący element do pliku projektu aplikacji PWA:</span><span class="sxs-lookup"><span data-stu-id="a6801-242">Add the following item to the PWA app's project file:</span></span>

```xml
<ItemGroup>
  <ServiceWorker Include="wwwroot\service-worker.js" 
    PublishedContent="wwwroot\service-worker.published.js" />
</ItemGroup>
```

## <a name="update-razor-class-libraries-rcls"></a><span data-ttu-id="a6801-243">Aktualizowanie Razor bibliotek klas (RCLs)</span><span class="sxs-lookup"><span data-stu-id="a6801-243">Update Razor class libraries (RCLs)</span></span>

<span data-ttu-id="a6801-244">Migruj Razor biblioteki klas (RCLs), aby korzystać z nowych interfejsów API lub funkcji wprowadzonych w ramach ASP.NET Core 5,0.</span><span class="sxs-lookup"><span data-stu-id="a6801-244">Migrate Razor class libraries (RCLs) to take advantage of new APIs or features that are introduced as part of ASP.NET Core 5.0.</span></span> 

<span data-ttu-id="a6801-245">Aby zaktualizować element RCL, który jest przeznaczony dla składników:</span><span class="sxs-lookup"><span data-stu-id="a6801-245">To update a RCL that targets components:</span></span>

1. <span data-ttu-id="a6801-246">Zaktualizuj następujące właściwości w pliku projektu:</span><span class="sxs-lookup"><span data-stu-id="a6801-246">Update the following properties in the project file:</span></span>

   ```diff
   <Project Sdk="Microsoft.NET.Sdk.Razor">
    
     <PropertyGroup>
   -     <TargetFramework>netstandard2.0</TargetFramework>
   -     <RazorLangVersion>3.0</RazorLangVersion>
   +     <TargetFramework>net5.0</TargetFramework>
     </PropertyGroup>
   ```

1. <span data-ttu-id="a6801-247">Zaktualizuj inne pakiety do ich najnowszych wersji.</span><span class="sxs-lookup"><span data-stu-id="a6801-247">Update other packages to their latest versions.</span></span> <span data-ttu-id="a6801-248">Najnowsze wersje można znaleźć pod adresem [NuGet.org](https://www.nuget.org).</span><span class="sxs-lookup"><span data-stu-id="a6801-248">The latest versions can be found at [NuGet.org](https://www.nuget.org).</span></span>

<span data-ttu-id="a6801-249">Aby zaktualizować RCL docelowy MVC, zaktualizuj następujące właściwości w pliku projektu:</span><span class="sxs-lookup"><span data-stu-id="a6801-249">To update an RCL targeting MVC, update the following properties in the project file:</span></span>

```diff
<Project Sdk="Microsoft.NET.Sdk.Razor">

  <PropertyGroup>
-    <TargetFramework>netcoreapp3.1</TargetFramework>
+    <TargetFramework>net5.0</TargetFramework>
    <AddRazorSupportForMvc>true</AddRazorSupportForMvc>
  </PropertyGroup>
```

## <a name="update-package-references"></a><span data-ttu-id="a6801-250">Aktualizuj odwołania do pakietów</span><span class="sxs-lookup"><span data-stu-id="a6801-250">Update package references</span></span>

<span data-ttu-id="a6801-251">W pliku projektu Zaktualizuj każdy [Microsoft. AspNetCore. \*](https://www.nuget.org/packages?q=Microsoft.AspNetCore.*), [Microsoft. EntityFrameworkCore. \*](https://www.nuget.org/packages?q=Microsoft.EntityFrameworkCore.*), [Microsoft. Extensions. \*](https://www.nuget.org/packages?q=Microsoft.Extensions.*), i [System.Net.Http.Js](https://www.nuget.org/packages/System.Net.Http.Json) atrybut odwołania pakietu `Version` do 5.0.0 lub nowszego.</span><span class="sxs-lookup"><span data-stu-id="a6801-251">In the project file, update each [Microsoft.AspNetCore.\*](https://www.nuget.org/packages?q=Microsoft.AspNetCore.*), [Microsoft.EntityFrameworkCore.\*](https://www.nuget.org/packages?q=Microsoft.EntityFrameworkCore.*), [Microsoft.Extensions.\*](https://www.nuget.org/packages?q=Microsoft.Extensions.*), and [System.Net.Http.Json](https://www.nuget.org/packages/System.Net.Http.Json) package reference's `Version` attribute to 5.0.0 or later.</span></span> <span data-ttu-id="a6801-252">Na przykład:</span><span class="sxs-lookup"><span data-stu-id="a6801-252">For example:</span></span>

```diff
<ItemGroup>
-    <PackageReference Include="Microsoft.AspNetCore.JsonPatch" Version="3.1.6" />
-    <PackageReference Include="Microsoft.EntityFrameworkCore.Tools" Version="3.1.6">
-    <PackageReference Include="Microsoft.Extensions.Caching.Abstractions" Version="3.1.6" />
-    <PackageReference Include="System.Net.Http.Json" Version="3.2.1" />
+    <PackageReference Include="Microsoft.AspNetCore.JsonPatch" Version="5.0.0" />
+    <PackageReference Include="Microsoft.EntityFrameworkCore.Tools" Version="5.0.0">
+    <PackageReference Include="Microsoft.Extensions.Caching.Abstractions" Version="5.0.0" />
+    <PackageReference Include="System.Net.Http.Json" Version="5.0.0" />
</ItemGroup>
```

## <a name="update-docker-images"></a><span data-ttu-id="a6801-253">Aktualizowanie obrazów platformy Docker</span><span class="sxs-lookup"><span data-stu-id="a6801-253">Update Docker images</span></span>

<span data-ttu-id="a6801-254">W przypadku aplikacji korzystających z platformy Docker zaktualizuj swoje  `FROM` instrukcje i skrypty pliku dockerfile.</span><span class="sxs-lookup"><span data-stu-id="a6801-254">For apps using Docker, update your *Dockerfile* `FROM` statements and scripts.</span></span> <span data-ttu-id="a6801-255">Użyj obrazu podstawowego zawierającego środowisko uruchomieniowe ASP.NET Core 5,0.</span><span class="sxs-lookup"><span data-stu-id="a6801-255">Use a base image that includes the ASP.NET Core 5.0 runtime.</span></span> <span data-ttu-id="a6801-256">Należy wziąć pod uwagę następujące `docker pull` różnice między ASP.NET Core 3,1 i 5,0:</span><span class="sxs-lookup"><span data-stu-id="a6801-256">Consider the following `docker pull` command difference between ASP.NET Core 3.1 and 5.0:</span></span>

```diff
- docker pull mcr.microsoft.com/dotnet/core/aspnet:3.1
+ docker pull mcr.microsoft.com/dotnet/aspnet:5.0
```

<span data-ttu-id="a6801-257">W ramach przenoszenia do ".NET" jako nazwy produktu, obrazy platformy Docker przenoszone z `mcr.microsoft.com/dotnet/core` repozytoriów do programu `mcr.microsoft.com/dotnet` .</span><span class="sxs-lookup"><span data-stu-id="a6801-257">As part of the move to ".NET" as the product name, the Docker images moved from the `mcr.microsoft.com/dotnet/core` repositories to `mcr.microsoft.com/dotnet`.</span></span> <span data-ttu-id="a6801-258">Aby uzyskać więcej informacji, zobacz [dotnet/dotnet-Docker # 1939](https://github.com/dotnet/dotnet-docker/issues/1939).</span><span class="sxs-lookup"><span data-stu-id="a6801-258">For more information, see [dotnet/dotnet-docker#1939](https://github.com/dotnet/dotnet-docker/issues/1939).</span></span>

## <a name="model-binding-changes-in-aspnet-core-mvc-and-razor-pages"></a><span data-ttu-id="a6801-259">Zmiany powiązań modelu w ASP.NET Core MVC i Razor stronach</span><span class="sxs-lookup"><span data-stu-id="a6801-259">Model binding changes in ASP.NET Core MVC and Razor Pages</span></span>

### <a name="datetime-values-are-model-bound-as-utc-times"></a><span data-ttu-id="a6801-260">Wartości DateTime są powiązane z modelem jako czas UTC</span><span class="sxs-lookup"><span data-stu-id="a6801-260">DateTime values are model bound as UTC times</span></span>

<span data-ttu-id="a6801-261">W ASP.NET Core 3,1 i wcześniejszych `DateTime` wartości były powiązane z modelem jako czas lokalny, w którym strefa czasowa została ustalona przez serwer.</span><span class="sxs-lookup"><span data-stu-id="a6801-261">In ASP.NET Core 3.1 and earlier, `DateTime` values were model-bound as local time, where the timezone was determined by the server.</span></span> <span data-ttu-id="a6801-262">`DateTime` wartości związane z formatowaniem danych wejściowych (JSON) i `DateTimeOffset` wartości były powiązane jako strefy czasowe UTC.</span><span class="sxs-lookup"><span data-stu-id="a6801-262">`DateTime` values bound from input formatting (JSON) and `DateTimeOffset` values were bound as UTC timezones.</span></span>

<span data-ttu-id="a6801-263">W ASP.NET Core 5,0 i nowszych powiązania modelu konsekwentnie wiążą `DateTime` wartości z strefą czasową UTC.</span><span class="sxs-lookup"><span data-stu-id="a6801-263">In ASP.NET Core 5.0 and later, model binding consistently binds `DateTime` values with the UTC timezone.</span></span>

<span data-ttu-id="a6801-264">Aby zachować poprzednie zachowanie, Usuń `DateTimeModelBinderProvider` w `Startup.ConfigureServices` :</span><span class="sxs-lookup"><span data-stu-id="a6801-264">To retain the previous behavior, remove the `DateTimeModelBinderProvider` in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddControllersWithViews(options => 
    options.ModelBinderProviders.RemoveType<DateTimeModelBinderProvider>());
```

### <a name="complexobjectmodelbinderprovider--complexobjectmodelbinder-replace-complextypemodelbinderprovider--complextypemodelbinder"></a><span data-ttu-id="a6801-265">ComplexObjectModelBinderProvider \ ComplexObjectModelBinder Zastąp ComplexTypeModelBinderProvider \ ComplexTypeModelBinder</span><span class="sxs-lookup"><span data-stu-id="a6801-265">ComplexObjectModelBinderProvider \ ComplexObjectModelBinder replace ComplexTypeModelBinderProvider \ ComplexTypeModelBinder</span></span>

<span data-ttu-id="a6801-266">Aby dodać obsługę powiązań modelu dla [typów rekordów C# 9](/dotnet/csharp/whats-new/csharp-9#record-types), <xref:Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexTypeModelBinderProvider> jest:</span><span class="sxs-lookup"><span data-stu-id="a6801-266">To add support for model binding [C# 9 record types](/dotnet/csharp/whats-new/csharp-9#record-types), the <xref:Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexTypeModelBinderProvider> is:</span></span>

* <span data-ttu-id="a6801-267">Adnotacje jako przestarzałe.</span><span class="sxs-lookup"><span data-stu-id="a6801-267">Annotated as obsolete.</span></span>
* <span data-ttu-id="a6801-268">Nie jest już zarejestrowana domyślnie.</span><span class="sxs-lookup"><span data-stu-id="a6801-268">No longer registered by default.</span></span>

<span data-ttu-id="a6801-269">Aplikacje korzystające z obecności `ComplexTypeModelBinderProvider` w `ModelBinderProviders` kolekcji muszą odwoływać się do nowego dostawcy programu Binder:</span><span class="sxs-lookup"><span data-stu-id="a6801-269">Apps that rely on the presence of the `ComplexTypeModelBinderProvider` in the `ModelBinderProviders` collection need to reference the new binder provider:</span></span>

```diff
- var complexModelBinderProvider = options.ModelBinderProviders.OfType<ComplexTypeModelBinderProvider>();
+ var complexModelBinderProvider = options.ModelBinderProviders.OfType<ComplexObjectModelBinderProvider>();
```

## <a name="usedatabaseerrorpage-obsolete"></a><span data-ttu-id="a6801-270">UseDatabaseErrorPage przestarzałe</span><span class="sxs-lookup"><span data-stu-id="a6801-270">UseDatabaseErrorPage obsolete</span></span>

<span data-ttu-id="a6801-271">Szablony ASP.NET Core 3,1, które zawierają opcję dla poszczególnych kont użytkowników, generują wywołanie <xref:Microsoft.AspNetCore.Builder.DatabaseErrorPageExtensions.UseDatabaseErrorPage%2A> .</span><span class="sxs-lookup"><span data-stu-id="a6801-271">The ASP.NET Core 3.1 templates that include an option for individual user accounts generate a call to <xref:Microsoft.AspNetCore.Builder.DatabaseErrorPageExtensions.UseDatabaseErrorPage%2A>.</span></span> <span data-ttu-id="a6801-272">`UseDatabaseErrorPage` jest już przestarzałe i należy go zastąpić kombinacją `AddDatabaseDeveloperPageExceptionFilter` i `UseMigrationsEndPoint` , jak pokazano w poniższym kodzie:</span><span class="sxs-lookup"><span data-stu-id="a6801-272">`UseDatabaseErrorPage` is now obsolete and should be replaced with a combination of `AddDatabaseDeveloperPageExceptionFilter` and `UseMigrationsEndPoint`, as shown in the following code:</span></span>

```diff
public void ConfigureServices(IServiceCollection services)
{
    services.AddDbContext<ApplicationDbContext>(options =>
        options.UseSqlServer(
            Configuration.GetConnectionString("DefaultConnection")));
+   services.AddDatabaseDeveloperPageExceptionFilter();
    services.AddDefaultIdentity<IdentityUser>(options => options.SignIn.RequireConfirmedAccount = true)
        .AddEntityFrameworkStores<ApplicationDbContext>();
    services.AddRazorPages();
}

public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
{
    if (env.IsDevelopment())
    {
        app.UseDeveloperExceptionPage();
+       app.UseMigrationsEndPoint();
-       app.UseDatabaseErrorPage();
    }
    else
    {
        app.UseExceptionHandler("/Error");
        app.UseHsts();
    }
```

<span data-ttu-id="a6801-273">Aby uzyskać więcej informacji, zobacz [ten problem](https://github.com/dotnet/aspnetcore/issues/24987)w serwisie GitHub.</span><span class="sxs-lookup"><span data-stu-id="a6801-273">For more information, see [this GitHub issue](https://github.com/dotnet/aspnetcore/issues/24987).</span></span>

## <a name="review-breaking-changes"></a><span data-ttu-id="a6801-274">Przejrzyj istotne zmiany</span><span class="sxs-lookup"><span data-stu-id="a6801-274">Review breaking changes</span></span>

<span data-ttu-id="a6801-275">Aby uzyskać istotne zmiany z platformy .NET Core 3,1 do platformy .NET 5,0, zobacz istotne [zmiany dotyczące migracji z wersji 3,1 do 5,0](/dotnet/core/compatibility/3.1-5.0).</span><span class="sxs-lookup"><span data-stu-id="a6801-275">For breaking changes from .NET Core 3.1 to .NET 5.0, see [Breaking changes for migration from version 3.1 to 5.0](/dotnet/core/compatibility/3.1-5.0).</span></span> <span data-ttu-id="a6801-276">Na liście znajdują się również ASP.NET Core i Entity Framework Core.</span><span class="sxs-lookup"><span data-stu-id="a6801-276">ASP.NET Core and Entity Framework Core are also included in the list.</span></span>
